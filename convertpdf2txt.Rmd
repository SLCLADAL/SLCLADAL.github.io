---
title: "Converting PDFs to txt files with R"
author: "Martin Schweinberger"
date: "`r format(Sys.time(), '%Y-%m-%d')`"
output:
  bookdown::html_document2: default
bibliography: bibliography.bib
link-citations: yes
---
```{r uq1, echo=F, fig.cap="", message=FALSE, warning=FALSE, out.width='100%'}
knitr::include_graphics("images/uq1.jpg")
```

This tutorial shows how to convert PDFs to simple txt (editor) files.  

**Activating packages and loading the data**

In a first step, we load the packages and inspect the data. 

```{r prep1, echo=T, eval = T, message=FALSE, warning=FALSE}
# activate packages
library(pdftools)
library(dplyr)
library(stringr)
```

Next, we define a path and convert the pdf that is located the path into a txt.

```{r pconv01, echo=T, eval = T, message=FALSE, warning=FALSE}
# you can use an url or a path that leads to a pdf dcument
pdf_path <- "data/PDFs/pdf0.pdf"
# extract text
txt_output <- pdftools::pdf_text(pdf_path) %>%
  paste(sep = " ") %>%
  stringr::str_replace_all(fixed("\n"), " ") %>%
  stringr::str_replace_all(fixed("\r"), " ") %>%
  stringr::str_replace_all(fixed("\t"), " ") %>%
  stringr::str_replace_all(fixed("\""), " ") %>%
  paste(sep = " ", collapse = " ") %>%
  stringr::str_squish() %>%
  stringr::str_replace_all("- ", "") 
# inspect
str(txt_output)
```

To convert many pdf-files, we write a function that predorms the conversion for many documents.

```{r pconv03, echo=T, eval = T, message=FALSE, warning=FALSE}
convertpdf2txt <- function(dirpath){
  files <- list.files(dirpath, full.names = T)
  x <- sapply(files, function(x){
  x <- pdftools::pdf_text(x) %>%
  paste(sep = " ") %>%
  stringr::str_replace_all(fixed("\n"), " ") %>%
  stringr::str_replace_all(fixed("\r"), " ") %>%
  stringr::str_replace_all(fixed("\t"), " ") %>%
  stringr::str_replace_all(fixed("\""), " ") %>%
  paste(sep = " ", collapse = " ") %>%
  stringr::str_squish() %>%
  stringr::str_replace_all("- ", "") 
  return(x)
    })
}
# apply function
txts <- convertpdf2txt("data/PDFs/")
# inspect data
txts[1]
```



