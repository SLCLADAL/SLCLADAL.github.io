---
title: "Converting PDFs to txt files with R"
author: "Martin Schweinberger"
date: "`r format(Sys.time(), '%Y-%m-%d')`"
output:
  bookdown::html_document2: default
bibliography: bibliography.bib
link-citations: yes
---
```{r uq1, echo=F, fig.cap="", message=FALSE, warning=FALSE, out.width='100%'}
knitr::include_graphics("images/uq1.jpg")
```

This tutorial shows how to convert PDFs to simple txt (editor) files.  

**Preparation and session set up**

As we will use R to convert files from PDF to txt, it is necessary to install R and RStudio. If these programs (or, in the case of R, environments) are not already installed on your machine, please search for them in your favourite search engine and add the term "download". Open any of the first few links and follow the installation instructions (they are easy to follow, do not require any specifications, and are pretty much self-explanatory).

In addition, certain *packages* need to be installed from an R *library* so that the scripts shown below are executed without errors. Before turning to the code below, please install the packages by running the code below this paragraph. If you have already installed the packages mentioned below, then you can skip ahead ignore this section. To install the necessary packages, simply run the following code - it may take some time (between 1 and 5 minutes to install all of the libraries so you do not need to worry if it takes some time).

```{r prep1, echo=T, eval = F, message=FALSE, warning=FALSE}
# clean current workspace
rm(list=ls(all=T))
# set options
options(stringsAsFactors = F)
# install libraries
install.packages(c("pdftools", "dplyr", "stringr"))
```

Once you have installed R, R-Studio, and have also initiated the session by executing the code shown above, you are good to go.

**Converting PDFs into txt files**

Now, we load the packages and inspect the data. 

```{r prep2, echo=T, eval = T, message=FALSE, warning=FALSE}
# activate packages
library(pdftools)
library(dplyr)
library(stringr)
```

Next, we define a path and convert the pdf that is located the path into a txt.

```{r pconv01, echo=T, eval = T, message=FALSE, warning=FALSE}
# you can use an url or a path that leads to a pdf dcument
pdf_path <- "https://slcladel.github.io/data/PDFs/pdf0.pdf"
# extract text
txt_output <- pdftools::pdf_text(pdf_path) %>%
  paste(sep = " ") %>%
  stringr::str_replace_all(fixed("\n"), " ") %>%
  stringr::str_replace_all(fixed("\r"), " ") %>%
  stringr::str_replace_all(fixed("\t"), " ") %>%
  stringr::str_replace_all(fixed("\""), " ") %>%
  paste(sep = " ", collapse = " ") %>%
  stringr::str_squish() %>%
  stringr::str_replace_all("- ", "") 
# inspect
str(txt_output)
```

To convert many pdf-files, we write a function that predorms the conversion for many documents.

```{r pconv03, echo=T, eval = T, message=FALSE, warning=FALSE}
convertpdf2txt <- function(dirpath){
  files <- list.files(dirpath, full.names = T)
  x <- sapply(files, function(x){
  x <- pdftools::pdf_text(x) %>%
  paste(sep = " ") %>%
  stringr::str_replace_all(fixed("\n"), " ") %>%
  stringr::str_replace_all(fixed("\r"), " ") %>%
  stringr::str_replace_all(fixed("\t"), " ") %>%
  stringr::str_replace_all(fixed("\""), " ") %>%
  paste(sep = " ", collapse = " ") %>%
  stringr::str_squish() %>%
  stringr::str_replace_all("- ", "") 
  return(x)
    })
}
# apply function
txts <- convertpdf2txt("https://slcladel.github.io/data/PDFs/")
# inspect data
txts[1]
```



