---
title: "Tabulating Data"
author: "UQ SLC Digital Team"
date: "`r format(Sys.time(), '%Y-%m-%d')`"
output:
  bookdown::html_document2: default
bibliography: bibliography.bib
link-citations: yes
---
```{r uq1, echo=F, fig.cap="", message=FALSE, warning=FALSE, out.width='100%'}
knitr::include_graphics("images/uq1.jpg")
```

# Introduction

This tutorial introduces tables and shows how to tabulate data. The entire code for the sections below can be downloaded [here](https://slcladal.github.io/rscripts/introtablesrscript.r).

# Preparation and session set up

As all visualizations in this tutorial rely on "R", it is necessary to install "RStudio" (a programm which makes working with R particularly user-friendly). If "RStudio" is not already installed on your machine, please search for "RStudio" in your favorite search engine and add the term "download". Open any of the first few links and follow the installation instructions (they are easy to follow, do not require any specifications, and are pretty much self-explanatory). Once you have installed "RStudio", open it.

In addition, we prepare our session by clearing the workspace, setting options, and installing certain "libraries" or "packages" that we need in this tutorial. Thus, please install the libraries by running the code below this paragraph (simply copy and paste the code into the editor window of RStudio and select "Run" from the task bar above) - the installation may take some time (depending on the number and the nature of the libraries it may take a couple of minutes).

```{r prep1, echo=T, eval = F, message=FALSE, warning=FALSE}
# clean current workspace
rm(list=ls(all=T))
# set options
options(stringsAsFactors = F)         # no automatic data transformation
options("scipen" = 100, "digits" = 4) # supress math annotation
# install libraries
install.packages(c("xlsx", "dplyr", "tidyr"))
```

Once you have installed "R", "R-Studio", "Tinn-R", and have also initiated the session by executing the code shown above, you are good to go.

# Introduction

Tables are one of the most important ways to describe data. This tutorial describes different types of tables, how to load and save different types of tables, as well as how to manipulate tables.

When working with R, there are different types of tables that have different characteristics. The most common types of tables in "R" are:

* matrices
* data frames
* tibbels

Matrices can only contain one type of data and all data points will be converted to the type of scale with the lowest information value. For instance, if at least one variables in a table represents characters (or strings), then all other variables are also converted into characters although they may be numbers. 

Data frames can contain different types of scales and variables are not converted automatically. In this sense, data frames are more flexible and are preferrable over matrices.

Tibbles are a new type of data frame that are created when working in the tidyverse dialect of "R". The tidyverse is a new "dialect" of "R" that is particularly user-friendly and specifically designed to make it easier to transform, process, and visualize data. The tidyverse style of "R" is associated with a set of libraries that allow the use tidyverse style (e.g. the packages "dplyr", "tidy", "tidyverse", "ggplot2"). 

# Loading tables into R

There are several different functions that allow us to read tabulated data into R. If the data is stored as a txt file, there are various functions to read in the data. The most common functiosn are "read.delim" and "read.table". 

```{r lt1, echo=T, eval = T, message=FALSE, warning=FALSE}
# load data with read.delim
mytable <- read.delim("https://slcladal.github.io/data/mlrdata.txt", header = TRUE)
# show first 6 lines of table
head(mytable)
```

```{r lt2, echo=T, eval = T, message=FALSE, warning=FALSE}
# load data with read.delim
myothertable <- read.table("https://slcladal.github.io/data/mlrdata.txt", header = TRUE)
# show first 6 lines of table
head(myothertable)
```

When a tables should be loaded from Excel, it is neccessary to load the "xlsx" library. The example below only works if you exchange the path with your own path to an xls or xlsx file. This is because if we want to load data from the LADAL server, loading the table becomes slightly more complex. You can try it out loading an xls or xlsx file with some xls or xlsx file on your own computer though.

```{r lt3, echo=T, eval = F, message=FALSE, warning=FALSE}
# load library
library(xlsx)
# load table into R
# WARNING! set your own path!
mytable <- read.xlsx("D:\\Uni\\UQ\\LADAL\\SLCLADAL.github.io\\data/testdata1.xlsx", 1)
# show first 6 lines of table
head(mytable)
```

The following section shows how to access and manipulate tables. 

# Dealing with tables in the Tidyverse

The tidyverse is a specific way of writing R code that builds on a family of libraries designed for efficient data science work flows which were developed initially by Hadley Wickham. This new way of writing R code buidls on a shared and underlying design philosophy and grammar. Due to its popularity and ease of use, the tidyverse way to write R code is becoming increasingly popular and we will use it in the following to handle and manipulate tabulated data. 

## Selecting and filtering

We assume that you have already loaded data into R and now want to process the data so that you can use it in your analysis. In a first step, we load the two most widely used packages for processing tabulated data: the *dplyr* and *tidyr* libraries and inspect the data before processing. 
```{r dp1, echo=T, eval = F, message=FALSE, warning=FALSE}
# load libraries
library(dplyr)
library(tidyr)
# inspect data before processing
nrow(myothertable); str(myothertable); table(myothertable$attraction)
```

The output shows that the table represents 3 variables (status, attraction, and money) and 100 rows which contain 50 people who are intersted and 50 who are not interested. We will now begin to process the data. 


Among the most frequent procedures in data processing is selecting certain columns or extracting rows based on variable levels. In the tidyverse, this is done by using the *select* and *filter* functions. Have a look at the example below.

```{r dp2, echo=T, eval = F, message=FALSE, warning=FALSE}
# select and filter
mytable <- myothertable %>%
  # select the columns attraction and money
  dplyr::select(attraction, money) %>%
  # extract rows which represent cases where the person was intersted in someone
  dplyr::filter(attraction == "Interested")
# inspect data before processing
nrow(mytable); table(mytable$attraction)
```

We have now reduced the data by excluding status (we have only selected attraction and money) and we have removed those 50 data rwows of people who were not interested.

```{r uq2, echo=F, fig.cap="", out.width = '100%'}
knitr::include_graphics("images/uq2.jpg")
```
