---
title: "Term Frequency and Inverse Document Frequency (TF-IDF) in NLP using R"
author: "Dattatreya Majumdar"
date: "`r format(Sys.time(), '%Y-%m-%d')`"
output:
  bookdown::html_document2: default
bibliography: bibliography.bib
link-citations: yes
---


# Introduction{-}

This tutorial introduces the concept of TF-IDF [see @silge2017text], which measures how important a word is to a document in a collection or corpus of documents. The entire code for the sections below can be downloaded [here](https://slcladal.github.io/tfidf.Rmd). 

*Term Frequency* is the measure of importance of a word in a document or how frequently it appears in that document. However there are some words such as "the","is", "of", etc. which appear frequently even though they might not be important. An approach of using a list of stop-words and removing them before analysis can be useful but in case of some documents these words might be highly relevant. 

*Inverse Document Frequency* decreases the weight for most used words and increases the weight for words that are not much used in a collection of documents. This together with the Term Frequency can be used to calculate a term's *tf-idf* (the multiplication of both the terms) which adjusts the frequency of the term based on how rarely it is used. Mathematically *idf* can be expressed as follows:

```{r idf, echo=FALSE, out.width= "60%", out.extra='style="float:center; padding:10px"'}
knitr::include_graphics("idf.PNG")
```

For this tutorial we will analyze the data set pertaining to Jane Austen's novels.

## Tools versus Scripts{-}

It is perfectly fine to use tools for the analyses exemplified below. However, the aim here is not primarily to show how to perform text analyses but how to perform text analyses in a way that complies with practices that guarantee sustainable, transparent, reproducible research. As R code can be readily shared and optimally contains all the data extraction, processing, vizualization, and analysis steps, using scripts is preferable over using (commercial) software. 

In addition to being not as transparent and hindering reproduction of research, using tools can also lead to dependencies on third parties which does not arise when using open source software. 

Finally, the widespread use of "R" particularly among data scientists, engineers, and analysts reduces the risk of software errors as a very active community corrects flawed functions typically quite rapidly. 

## Preparation and session set up{-}


This tutorial is based on R. If you have not installed R or are new to it, you will find an introduction to and more information how to use R [here](https://slcladal.github.io/IntroR_workshop.html). For this tutorials, we need to install certain *packages* from an R *library* so that the scripts shown below are executed without errors. Before turning to the code below, please install the packages by running the code below this paragraph. If you have already installed the packages mentioned below, then you can skip ahead ignore this section. To install the necessary packages, simply run the following code - it may take some time (between 1 and 5 minutes to install all of the libraries so you do not need to worry if it takes some time).



Once you have installed R Studio and initiated the session by executing the code shown above, you are good to go.

## Implementation in R{-}

For this tutorial we will be primarily requiring 3 packages: *tidytext*, *janeaustenr* and *ggplot2*. *tidytext* provides functions and supporting data sets to allow conversion of text to and from tidy formats, and to switch seamlessly between tidy tools and existing text mining packages. *janeaustenr* is used to load the collection of novels by Jane Austen. *ggplot2* is used for  visualization and other aesthetics.

## Term frequency in Jane Austen's novels{-}

We will start by analysing Jane Austen's novels and determine term-frequency and then determine idf. 

```{r prep1, echo=T, eval = F, message=FALSE, warning=FALSE}
# clean current workspace
rm(list=ls(all=T))
# set options
options(stringsAsFactors = F)
# install libraries
install.packages(c("tidytext","janeaustenr","ggplot2"))
```

```{r book_words}
library(dplyr)
library(janeaustenr)
library(tidytext)

book_words <- austen_books() %>%
  unnest_tokens(word, text) %>%
  count(book, word, sort = TRUE)

total_words <- book_words %>% 
  group_by(book) %>% 
  summarize(total = sum(n))

book_words <- left_join(book_words, total_words)

print(book_words)
```

From the above table it is evident that the usual suspects "the", "and" ,"to" and so-forth are leading in terms of their usage in that book. Now let us look at the distribution of *n/total* for each novel, which actually is the term frequency.

```{r tfplot, dependson = book_words, fig.height=6, fig.width=6, fig.cap="Term frequency distribution in Jane Austen's novels"}
library(ggplot2)

ggplot(book_words, aes(n/total, fill = book)) +
  geom_histogram(show.legend = FALSE) +
  xlim(NA, 0.0009) +
  facet_wrap(~book, ncol = 2, scales = "free_y")
```
From the plots it is clear that there many words which occur rarely and fewer words that occur frequently. 


## Zipf's Law{-}

This law states that the frequency that a word appears is inversely proportional to its rank. The piece of code below examines Zipf's Law for Jane Austen's novels.

```{r Zipf, dependson = book_words}
freq_by_rank <- book_words %>% 
  group_by(book) %>% 
  mutate(rank = row_number(), 
         `term frequency` = n/total) %>%
  ungroup()

freq_by_rank
```

To have a more clear understanding let us visualize by plotting on the rank on the X-axis and term frequency on the Y-axis, on logarithmic scales.

```{r fr, dependson = "Zipf", fig.width=5, fig.height=4.5, fig.cap="Zipf's law for Jane Austen's novels"}
freq_by_rank %>% 
  ggplot(aes(rank, `term frequency`, color = book)) + 
  geom_line(size = 1.1, alpha = 0.8, show.legend = FALSE) + 
  scale_x_log10() +
  scale_y_log10()
```
We can see that the plot has a negative slope which corroborates the inverse relationship of rank with respect to term frequency. 

## The *bind_tf_idf()* function{-}

The concept behind tf-idf is to figure out the important words of each document by decreasing the weight for commonly used words and increasing the weight for words that are not used extensively in a collection or corpus of documents.Using the *bind_tf_idf()* function in *tidytext* package tf-idf score has been evaluated along with other parameters such as number of occurences of that word, total number of words and term frequency.

```{r book_tf_idf, dependson = "book_words"}
book_tf_idf <- book_words %>%
  bind_tf_idf(word, book, n)

book_tf_idf
```

From the above table it is evident that the extremely common words have a very low inverse document frequency and thus a low tf-idf score. The inverse document frequency will be a higher number for words that occur in fewer documents in the collection of novels.

```{r high_tf_idf, dependson = "book_tf_idf"}
book_tf_idf %>%
  select(-total) %>%
  arrange(desc(tf_idf))
```

For better visualisation of the words having high tf-idf scores in Jane Austen's novels the following plots will be helpful.

```{r high_tf_idfplot,  dependson = "plot_austen", fig.height=8, fig.width=6, fig.cap="Highest tf-idf words in each of Jane Austen's Novels"}
library(forcats)

book_tf_idf %>%
  group_by(book) %>%
  slice_max(tf_idf, n = 15) %>%
  ungroup() %>%
  ggplot(aes(tf_idf, fct_reorder(word, tf_idf), fill = book)) +
  geom_col(show.legend = FALSE) +
  facet_wrap(~book, ncol = 2, scales = "free") +
  labs(x = "tf-idf", y = NULL)
```







# Citation & Session Info {-}

Majumdar, Dattatreya. 2020. *Term Frequency and Inverse Document Frequency (TF-IDF) in NLP using R*. Brisbane: The University of Queensland. url: https://slcladal.github.io/tfidf.html (Version 2020.11.20).

```
@manual{Majumdar2020ta,
  author = {Majumdar, Dattatreya},
  title = {Term Frequency and Inverse Document Frequency (TF-IDF) in NLP using R},
  note = {https://slcladal.github.io/tfidf.html},
  year = {2020},
  organization = "The University of Queensland, Australia. School of Languages and Cultures},
  address = {Brisbane},
  edition = {2020/11/20}
}
```



```{r fin}
sessionInfo()
```

***

[Main page](https://slcladal.github.io/index.html)

***

# References {-}


