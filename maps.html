<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">

<head>

<meta charset="utf-8" />
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="generator" content="pandoc" />


<meta name="author" content="UQ SLC Digital Team" />

<meta name="date" content="2019-08-02" />

<title>Creating Maps in R</title>

<script src="site_libs/jquery-1.11.3/jquery.min.js"></script>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<link href="site_libs/bootstrap-3.3.5/css/cosmo.min.css" rel="stylesheet" />
<script src="site_libs/bootstrap-3.3.5/js/bootstrap.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/html5shiv.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/respond.min.js"></script>
<script src="site_libs/jqueryui-1.11.4/jquery-ui.min.js"></script>
<link href="site_libs/tocify-1.9.1/jquery.tocify.css" rel="stylesheet" />
<script src="site_libs/tocify-1.9.1/jquery.tocify.js"></script>
<script src="site_libs/navigation-1.1/tabsets.js"></script>
<link href="site_libs/highlightjs-9.12.0/default.css" rel="stylesheet" />
<script src="site_libs/highlightjs-9.12.0/highlight.js"></script>
<link href="site_libs/font-awesome-5.0.13/css/fa-svg-with-js.css" rel="stylesheet" />
<script src="site_libs/font-awesome-5.0.13/js/fontawesome-all.min.js"></script>
<script src="site_libs/font-awesome-5.0.13/js/fa-v4-shims.min.js"></script>

<style type="text/css">code{white-space: pre;}</style>
<style type="text/css">
  pre:not([class]) {
    background-color: white;
  }
</style>
<script type="text/javascript">
if (window.hljs) {
  hljs.configure({languages: []});
  hljs.initHighlightingOnLoad();
  if (document.readyState && document.readyState === "complete") {
    window.setTimeout(function() { hljs.initHighlighting(); }, 0);
  }
}
</script>



<style type="text/css">
h1 {
  font-size: 34px;
}
h1.title {
  font-size: 38px;
}
h2 {
  font-size: 30px;
}
h3 {
  font-size: 24px;
}
h4 {
  font-size: 18px;
}
h5 {
  font-size: 16px;
}
h6 {
  font-size: 12px;
}
.table th:not([align]) {
  text-align: left;
}
</style>


</head>

<body>

<style type = "text/css">
.main-container {
  max-width: 940px;
  margin-left: auto;
  margin-right: auto;
}
code {
  color: inherit;
  background-color: rgba(0, 0, 0, 0.04);
}
img {
  max-width:100%;
  height: auto;
}
.tabbed-pane {
  padding-top: 12px;
}
.html-widget {
  margin-bottom: 20px;
}
button.code-folding-btn:focus {
  outline: none;
}
</style>


<style type="text/css">
/* padding for bootstrap navbar */
body {
  padding-top: 51px;
  padding-bottom: 40px;
}
/* offset scroll position for anchor links (for fixed navbar)  */
.section h1 {
  padding-top: 56px;
  margin-top: -56px;
}

.section h2 {
  padding-top: 56px;
  margin-top: -56px;
}
.section h3 {
  padding-top: 56px;
  margin-top: -56px;
}
.section h4 {
  padding-top: 56px;
  margin-top: -56px;
}
.section h5 {
  padding-top: 56px;
  margin-top: -56px;
}
.section h6 {
  padding-top: 56px;
  margin-top: -56px;
}
</style>

<script>
// manage active state of menu based on current page
$(document).ready(function () {
  // active menu anchor
  href = window.location.pathname
  href = href.substr(href.lastIndexOf('/') + 1)
  if (href === "")
    href = "index.html";
  var menuAnchor = $('a[href="' + href + '"]');

  // mark it active
  menuAnchor.parent().addClass('active');

  // if it's got a parent navbar menu mark it active as well
  menuAnchor.closest('li.dropdown').addClass('active');
});
</script>


<div class="container-fluid main-container">

<!-- tabsets -->
<script>
$(document).ready(function () {
  window.buildTabsets("TOC");
});
</script>

<!-- code folding -->




<script>
$(document).ready(function ()  {

    // move toc-ignore selectors from section div to header
    $('div.section.toc-ignore')
        .removeClass('toc-ignore')
        .children('h1,h2,h3,h4,h5').addClass('toc-ignore');

    // establish options
    var options = {
      selectors: "h1,h2,h3",
      theme: "bootstrap3",
      context: '.toc-content',
      hashGenerator: function (text) {
        return text.replace(/[.\\/?&!#<>]/g, '').replace(/\s/g, '_').toLowerCase();
      },
      ignoreSelector: ".toc-ignore",
      scrollTo: 0
    };
    options.showAndHide = true;
    options.smoothScroll = true;

    // tocify
    var toc = $("#TOC").tocify(options).data("toc-tocify");
});
</script>

<style type="text/css">

#TOC {
  margin: 25px 0px 20px 0px;
}
@media (max-width: 768px) {
#TOC {
  position: relative;
  width: 100%;
}
}


.toc-content {
  padding-left: 30px;
  padding-right: 40px;
}

div.main-container {
  max-width: 1200px;
}

div.tocify {
  width: 20%;
  max-width: 260px;
  max-height: 85%;
}

@media (min-width: 768px) and (max-width: 991px) {
  div.tocify {
    width: 25%;
  }
}

@media (max-width: 767px) {
  div.tocify {
    width: 100%;
    max-width: none;
  }
}

.tocify ul, .tocify li {
  line-height: 20px;
}

.tocify-subheader .tocify-item {
  font-size: 0.90em;
  padding-left: 25px;
  text-indent: 0;
}

.tocify .list-group-item {
  border-radius: 0px;
}


</style>

<!-- setup 3col/9col grid for toc_float and main content  -->
<div class="row-fluid">
<div class="col-xs-12 col-sm-4 col-md-3">
<div id="TOC" class="tocify">
</div>
</div>

<div class="toc-content col-xs-12 col-sm-8 col-md-9">




<div class="navbar navbar-default  navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="index.html">LADAL</a>
    </div>
    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    <span class="fa fa-play-circle"></span>
     
    Basics
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li class="dropdown-header">Basics</li>
    <li>
      <a href="introquant.html">Introduction To Quantitative Reasoning</a>
    </li>
    <li>
      <a href="basicquant.html">Basic Concepts In Quantitative Reasoning</a>
    </li>
    <li class="divider"></li>
    <li class="dropdown-header">Research Designs</li>
    <li>
      <a href="researchdesigns.html">Overview</a>
    </li>
    <li>
      <a href="corpling.html">Corpus Linguistics</a>
    </li>
    <li>
      <a href="experiments.html">Experimental Designs</a>
    </li>
    <li>
      <a href="acoustic.html">Acoustic Analysis</a>
    </li>
    <li class="divider"></li>
    <li class="dropdown-header">Data Collection</li>
    <li>
      <a href="introdatacollection.html">Introduction</a>
    </li>
    <li>
      <a href="questionnaires.html">Questionnaires and Surveys</a>
    </li>
  </ul>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    <span class="fa fa-gear"></span>
     
    Data Processing
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li class="dropdown-header">Data Processing</li>
    <li>
      <a href="intror.html">Basics: Getting started with R</a>
    </li>
    <li>
      <a href="introloading.html">Loading and saving data</a>
    </li>
    <li>
      <a href="stringprocessing.html">String processing</a>
    </li>
    <li>
      <a href="regularexpressions.html">Regular expressions</a>
    </li>
    <li>
      <a href="introtables.html">Tabulating data</a>
    </li>
    <li class="divider"></li>
    <li>
      <a href="dataprocessingexcel.html">Data Processing with Excel</a>
    </li>
  </ul>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    <span class="fa fa-bar-chart"></span>
     
    Visualization
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li class="dropdown-header">Visualization</li>
    <li>
      <a href="basicgraphs.html">Basic Visualization with R</a>
    </li>
    <li>
      <a href="maps.html">Creating Maps in R</a>
    </li>
  </ul>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    <span class="fa fa-eye"></span>
     
    Statistics
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li class="dropdown-header">Statistics</li>
    <li>
      <a href="descriptivestatz.html">Descriptive Statistics</a>
    </li>
    <li class="divider"></li>
    <li class="dropdown-header">Basic Interential Statistics</li>
    <li>
      <a href="basicstatz.html">Basic Inferential Tests</a>
    </li>
    <li>
      <a href="basicstatzchi.html">The Chi-Square Family</a>
    </li>
    <li>
      <a href="basicstatzregression.html">Simple Linear Regression</a>
    </li>
    <li class="divider"></li>
    <li class="dropdown-header">Advanced Interential Statistics</li>
    <li>
      <a href="fixedregressions.html">Fixed-Effects Regression Models</a>
    </li>
    <li>
      <a href="mixedregressions.html">Mixed-Effects Regression Models</a>
    </li>
    <li>
      <a href="advancedstatztrees.html">Tree-Based Models</a>
    </li>
    <li>
      <a href="groupingstatz.html">Classification</a>
    </li>
    <li>
      <a href="collostructionalanalysis.html">Collostructional Analysis</a>
    </li>
  </ul>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    <span class="fa fa-bars"></span>
     
    Text Analysis/Corpus Linguistics
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li class="dropdown-header">Text Analysis</li>
    <li>
      <a href="textanalysis.html">Introduction</a>
    </li>
    <li>
      <a href="webcrawling.html">Web Crawling</a>
    </li>
    <li>
      <a href="network.html">Network Analysis</a>
    </li>
    <li>
      <a href="topicmodels.html">Topic Modeling</a>
    </li>
    <li>
      <a href="classification.html">Classification</a>
    </li>
    <li>
      <a href="tagging.html">Tagging and Parsing</a>
    </li>
    <li class="divider"></li>
    <li class="dropdown-header">Corpus Linguistics</li>
    <li>
      <a href="corplingr.html">Corpus Linguistics in R</a>
    </li>
  </ul>
</li>
      </ul>
      <ul class="nav navbar-nav navbar-right">
        <li>
  <a href="about.html">
    <span class="fa fa-info"></span>
     
    Contact
  </a>
</li>
      </ul>
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

<div class="fluid-row" id="header">



<h1 class="title toc-ignore">Creating Maps in R</h1>
<h4 class="author"><em>UQ SLC Digital Team</em></h4>
<h4 class="date"><em>2019-08-02</em></h4>

</div>


<p><img src="images/uq1.jpg" width="100%" /></p>
<div id="introduction" class="section level1">
<h1><span class="header-section-number">1</span> Introduction</h1>
<p>This tutorial introduces how to create maps in “R”. The entire code for the sections below can be downloaded <a href="https://slcladal.github.io/rscripts/mapsrscript.r">here</a>.</p>
</div>
<div id="preparation-and-session-set-up" class="section level1">
<h1><span class="header-section-number">2</span> Preparation and session set up</h1>
<p>As all visualizations in this tutorial rely on “R”, it is necessary to install “R”, “RStudio”, and “Tinn-R”. If these programms (or, in the case of “R”, environments) are not already installed on your machine, please search for them in your favorite search engine and add the term “download”. Open any of the first few links and follow the installation instructions (they are easy to follow, do not require any specifications, and are pretty much self-explanatory).</p>
<p>In addition, certain “libraries” or “packages” need to be installed so that the scripts shown below are executed without errors. Before turning to the code below, please install the librariesby running the code below this paragraph. If you have already installed the libraries mentioned below, then you can skip ahead ignore this section. To install the necessary libraries, simply run the following code - it may take some time (between 1 and 5 minutes to install all of the libraries so you do not need to worry if it takes some time).</p>
<pre class="r"><code># clean current workspace
rm(list=ls(all=T))
# set options
options(stringsAsFactors = F)         # no automatic data transformation
options(&quot;scipen&quot; = 100, &quot;digits&quot; = 4) # supress math annotation
# install libraries
install.packages(c(&quot;RgoogleMaps&quot;, &quot;ggmap&quot;, &quot;mapproj&quot;, &quot;sf&quot;,
                   &quot;dplyr&quot;, &quot;OpenStreetMap&quot;, &quot;devtools&quot;))
# install package from github
devtools::install_github(&quot;dkahle/ggmap&quot;, ref = &quot;tidyup&quot;)</code></pre>
<p>Depending on the maps that are used in the visualization, it may also be neccessary to access other data bases. One very useful data base for maps is, of course, Google Maps. However, to access Google Maps materials, installation and setting up other pieces of software is neccessary. How to get access to Google’s data is discussed below. In the following section, methods that do not require installation of software other than “R”.</p>
</div>
<div id="getting-started-with-maps" class="section level1">
<h1><span class="header-section-number">3</span> Getting started with maps</h1>
<p>The most basic way to display geospacial data is to simply download and display a map. In order to do that, we load the libraries neccessary for extracting and plotting the map, before we can go ahead and actually extracting and ploting the map.</p>
<p>The package “OpenStreetMap” offers a range of maps with different features. To access the OpenStreetMap data base, it is neccessary to install the package. Once the package is installed, we can simply extract the map and define the region we want to plot by defining the longitude and latitude of the upper left and lower right corner of the region we want to display. The argument “minNumTiles” defines the accuracy of the map, the higher the number of tiles, the higher the resolution. The type of map is defined by the “type” argument. The type argument defines from which server the map is extracted. Once we have extracted a map, we can plot it using the “plot” function.</p>
<pre class="r"><code># load library
library(OpenStreetMap)
# extract map
australia &lt;- openmap(c(-8,110),
    c(-45,160),
    type = &quot;esri&quot;,
    minNumTiles=6)
# plot map
plot(australia)</code></pre>
<p><img src="maps_files/figure-html/map1-1.png" width="672" /></p>
<p>In order to obtain different map types, we change the “type” argument. The following options are available for type: “osm”, “osm-bw”,“maptoolkit-topo”, “waze”, “bing”, “stamen-toner”, “stamen-terrain”, “stamen-watercolor”, “osm-german”, “osm-wanderreitkarte”, “mapbox”, “esri”, “esri-topo”, “nps”, “apple-iphoto”, “skobbler”, “hillshade”, “opencyclemap”, “osm-transport”, “osm-public-transport”, “osm-bbike”, “osm-bbike-german”. Unfortunately, not all options work. If they do not work, then an error message is shwn telling us that the number of tiles is not supported.</p>
<p>We can zoom in or out by either changing the “zoom” or the “minNumTiles” arguments - in both cases, the higher the number, the more fine-grained the dispalyed map. Let’s check out some examples for maps of Queensland.</p>
<pre class="r"><code># extract map
queensland1 &lt;- openmap(c(-8,135),
    c(-30,160),
    type = &quot;osm&quot;,
    minNumTiles=6)
queensland2 &lt;- openmap(c(-8,135),
    c(-30,160),
    type = &quot;esri-topo&quot;,
    minNumTiles=6)
queensland3 &lt;- openmap(c(-8,135),
    c(-30,160),
    type = &quot;nps&quot;,
    minNumTiles=6)
# plot maps
par(mfrow = c(1, 3)) # display plots in 1 row/3 columns
plot(queensland1); plot(queensland2); plot(queensland3); par(mfrow = c(1, 1)) # restore original settings</code></pre>
<p><img src="maps_files/figure-html/map2-1.png" width="672" /></p>
<p>Another data base that is very useful when certaing maps is the “rworldmap” package. The “worldmap” package contains the shape files for countries but also more fine grained-shape files that display the states of selected countries. The most basic data, however, simply represents the shapes of the countries in the world.</p>
<p>Using the “worldmap” package has the advantage that one is not dependent on third parties and their servers but can operate within “R” wihtout being denyed access due to e.g. copy right issues or server maintenance.</p>
<pre class="r"><code># load library
library(rworldmap)
# get map
worldmap &lt;- getMap(resolution = &quot;coarse&quot;)
# plot worldmap
plot(worldmap, xlim = c(-180, 180), ylim = c(-90, 90), 
     asp = 1, wrap=c(-180,180))</code></pre>
<p><img src="maps_files/figure-html/map3-1.png" width="672" /></p>
<p>The basic map shown above can then be modified and enriched with color coding to convey geospatial data. The following shows how to customize the world map.</p>
</div>
<div id="customizing-maps" class="section level1">
<h1><span class="header-section-number">4</span> Customizing Maps</h1>
<p>Displaying basic maps is usually less interesting because, typically, we want to add different layers to a map. In order to add layers to a map, we need to have a shape file, i.e. a file which contains information about borders or locations that can then be displayed in different colors.</p>
<p>In other words, we need to have a shape object to add information to the map.</p>
<p>We load the “airports” data set which contains the longitude and latitude of airports across the world.</p>
<pre class="r"><code># load data
airports &lt;- read.delim(&quot;D:\\Uni\\UQ\\LADAL\\SLCLADAL.github.io\\data/airports.txt&quot;, sep = &quot;\t&quot;, header = T)
# inspect data
head(airports)</code></pre>
<pre><code>##   ID                                        Name         City
## 1  1                              Goroka Airport       Goroka
## 2  2                              Madang Airport       Madang
## 3  3                Mount Hagen Kagamuga Airport  Mount Hagen
## 4  4                              Nadzab Airport       Nadzab
## 5  5 Port Moresby Jacksons International Airport Port Moresby
## 6  6                 Wewak International Airport        Wewak
##            Country  Latitude Longitude
## 1 Papua New Guinea -6.081690   145.392
## 2 Papua New Guinea -5.207080   145.789
## 3 Papua New Guinea -5.826790   144.296
## 4 Papua New Guinea -6.569803   146.726
## 5 Papua New Guinea -9.443380   147.220
## 6 Papua New Guinea -3.583830   143.669</code></pre>
<p>To display the locations of airports on a map, we first plot the map and then add a layer of points to indicate the location of airports. In addition, the “plot” functions offers various arguments for customizing the display, e.g. by changing the backgroundcolor (bg), defining the color of borders (borders), defining the color of the shapes (fill and col).</p>
<pre class="r"><code># plot data on world map
plot(worldmap, xlim = c(-80, 160), ylim = c(-50, 100), 
     asp = 1, bg = &quot;lightblue&quot;, col = &quot;black&quot;, fill = T)
# add points
points(airports$Longitude, airports$Latitude, col = &quot;red&quot;, cex = .01)</code></pre>
<p><img src="maps_files/figure-html/cus2-1.png" width="672" /></p>
<p>It is, of course also possible to show only a part of the map by defining the x- and y-axes limits of the plot window.</p>
<pre class="r"><code># load library
library(rworldmap)
# get map
newmap &lt;- getMap(resolution = &quot;low&quot;)
# plot map
plot(newmap, xlim = c(-20, 59), ylim = c(35, 71), 
     asp = 1, fill = T, border = &quot;darkgray&quot;, 
     col = &quot;wheat2&quot;, bg = &quot;gray95&quot;)
# add points
points(airports$Longitude, airports$Latitude, col = &quot;red&quot;, cex = .5, pch = 20)</code></pre>
<p><img src="maps_files/figure-html/cus3-1.png" width="672" /></p>
<p>This is of course also possible to show Australian airports.</p>
<pre class="r"><code># plot data on world map
plot(worldmap, xlim = c(120, 140), ylim = c(-45, -10), 
     asp = 1, bg = &quot;lightblue&quot;, border = &quot;lightgrey&quot;, col = &quot;wheat3&quot;, 
     fill = T, wrap=c(-180,180))
points(airports$Longitude, airports$Latitude, 
       col = &quot;darkblue&quot;, cex = .5, pch = 20)</code></pre>
<p><img src="maps_files/figure-html/cus4-1.png" width="672" /></p>
<p>In addition to the location of airports, it is also possible to show how many flights arrive at an airport. As this information is not provided in the airport data, we load the routes data which contains information about the routes that airlines fly.</p>
<pre class="r"><code># read in routes data
routes &lt;- read.delim(&quot;D:\\Uni\\UQ\\LADAL\\SLCLADAL.github.io\\data/routes.txt&quot;, sep = &quot;\t&quot;, header=T)
# inspect first 6 lines of routes data
head(routes)</code></pre>
<pre><code>##   airline airlineID sourceAirport sourceAirportID destinationAirport
## 1      2B       410           AER            2965                KZN
## 2      2B       410           ASF            2966                KZN
## 3      2B       410           ASF            2966                MRV
## 4      2B       410           CEK            2968                KZN
## 5      2B       410           CEK            2968                OVB
## 6      2B       410           DME            4029                KZN
##   destinationAirportID
## 1                 2990
## 2                 2990
## 3                 2962
## 4                 2990
## 5                 4078
## 6                 2990</code></pre>
<p>To show the number of arrivals at an airport (only in terms of how mayn routes end at that airport), we extract the number of routes that end in each airport.</p>
<pre class="r"><code># load library
library(plyr)
# extract number of arrivals
arrivals &lt;- ddply(routes, .(destinationAirportID), &quot;nrow&quot;)
names(arrivals)[2] &lt;- &quot;flights&quot;
# inspect data
head(arrivals)</code></pre>
<pre><code>##   destinationAirportID flights
## 1                  \\N     221
## 2                    1       5
## 3                   10       2
## 4                  100      44
## 5                 1001       4
## 6                 1004       7</code></pre>
<p>We can now merge the airports and the arrival data set to combine the information about the location with the information about the number of routes that end at each airport.</p>
<pre class="r"><code># create arrival  table
airportA &lt;- merge(airports, arrivals, by.x = &quot;ID&quot;, by.y = &quot;destinationAirportID&quot;)
# inspect arrival table
head(airportA)</code></pre>
<pre><code>##   ID                                        Name         City
## 1  1                              Goroka Airport       Goroka
## 2  2                              Madang Airport       Madang
## 3  3                Mount Hagen Kagamuga Airport  Mount Hagen
## 4  4                              Nadzab Airport       Nadzab
## 5  5 Port Moresby Jacksons International Airport Port Moresby
## 6  6                 Wewak International Airport        Wewak
##            Country  Latitude Longitude flights
## 1 Papua New Guinea -6.081690   145.392       5
## 2 Papua New Guinea -5.207080   145.789       8
## 3 Papua New Guinea -5.826790   144.296      12
## 4 Papua New Guinea -6.569803   146.726      11
## 5 Papua New Guinea -9.443380   147.220      50
## 6 Papua New Guinea -3.583830   143.669       6</code></pre>
<p>This table allows us to plot not only the location of airports but also the number of routes that end there.</p>
<pre class="r"><code># get map
australia &lt;- getMap(resolution = &quot;low&quot;)
# plot data on world map
plot(australia, xlim = c(135, 136), ylim = c(-45, -10), 
     asp = 1, bg = &quot;lightblue&quot;, border = &quot;darkgrey&quot;, 
     col = &quot;wheat3&quot;, fill = T)
# add points
points(airportA$Longitude, airportA$Latitude,
       # define colors as transparent
       col = rgb(red = 0, green = 0, blue = 1, alpha = 0.3),
       # define size as number of flights div. by 50
       cex = airportA$flights/50, pch = 20)</code></pre>
<p><img src="maps_files/figure-html/cus8-1.png" width="672" /></p>
</div>
<div id="color-coding-geospatial-information" class="section level1">
<h1><span class="header-section-number">5</span> Color Coding Geospatial Information</h1>
<p>We can also use color coding of countries to convey information about different features of countries such as their population size (or results of political elecetions, etc.).</p>
<pre class="r"><code># load libraries
library(maps)
library(RColorBrewer)
# load data
worldpopulation &lt;- read.delim(&quot;D:\\Uni\\UQ\\LADAL\\SLCLADAL.github.io\\data/worldpopulation.txt&quot;, sep = &quot;\t&quot;, header = T)
# inspect data
head(worldpopulation)</code></pre>
<pre><code>##          Country Population
## 1    Afghanistan    7543856
## 2        Albania    1536232
## 3        Algeria   20508642
## 4 American Samoa      58021
## 5        Andorra      69031
## 6         Angola    4535443</code></pre>
<p>We use this information about the population size of countries and use color coding to visualize differences in population size by country.</p>
<pre class="r"><code># create a color palette
palette = colorRampPalette(brewer.pal(n=9, name=&#39;Oranges&#39;))(nrow(worldpopulation))
# sort the colors in the same order as the countries&#39; populations
palette = palette[rank(-worldpopulation$Population)]
# draw a map of the world
map(database=&#39;world&#39;, fill = T, border = &quot;darkgray&quot;, 
    col = palette, bg = &quot;gray95&quot;, ylim = c(-60, 85))</code></pre>
<p><img src="maps_files/figure-html/col2-1.png" width="672" /></p>
<p>It is relatively easy to combine color coding with points. However, it is substantially easier if all countries have values. If this is not the case (as in the example below), we need to include an additional step so that countries that are not mentioned also receive a color coding.</p>
<p>In a first setp, the work space is cleared, the options are set, and the relevant libraries are loaded.</p>
<pre class="r"><code># clean current workspace
rm(list=ls(all=T))
# set options
options(stringsAsFactors = F)         # no automatic data transformation
options(&quot;scipen&quot; = 100, &quot;digits&quot; = 4) # supress math annotation
# load libraries
library(ggmap)
library(maptools)
library(maps)
library(geonames)</code></pre>
<p>Then, the data that will be displayed is loaded. In the present case, the data contain countries and cities that I have visited along with their latitude and longitude.</p>
<pre class="r"><code># load data
visited &lt;- read.delim(&quot;D:\\Uni\\UQ\\LADAL\\SLCLADAL.github.io\\data/visited.txt&quot;, sep = &quot;\t&quot;, header = T)
# inspect data
head(visited)</code></pre>
<pre><code>##     Country ISO3      City Latitude Longitude
## 1 Australia  AUS  Adelaide   -34.94    138.60
## 2 Australia  AUS  Brisbane   -27.45    153.04
## 3 Australia  AUS  Canberra   -35.28    149.13
## 4 Australia  AUS Melbourne   -37.82    144.97
## 5 Australia  AUS    Sydney   -33.92    151.19
## 6   Austria  AUT Innsbruck    47.28     11.41</code></pre>
<p>After loading the data, we determine how many cities I have visited in a given country and add this frequency to the data set.</p>
<pre class="r"><code># determine how often a country was visited
ncountry &lt;- as.data.frame(table(visited$ISO3))
colnames(ncountry)[1] &lt;- &quot;ISO3&quot; 
# add frequency to visited
visited &lt;- merge(visited, ncountry, by = &quot;ISO3&quot;)
# inspect data
head(visited)</code></pre>
<pre><code>##   ISO3              Country      City Latitude Longitude Freq
## 1  ARE United Arab Emirates Abu Dhabi    24.47     54.37    2
## 2  ARE United Arab Emirates     Dubai    25.23     55.28    2
## 3  AUS            Australia  Adelaide   -34.94    138.60    5
## 4  AUS            Australia  Brisbane   -27.45    153.04    5
## 5  AUS            Australia  Canberra   -35.28    149.13    5
## 6  AUS            Australia Melbourne   -37.82    144.97    5</code></pre>
<p>The next part is tricky as we do not only need to determine the color for the countries I have visited but also the color for those that I have not visited. In order to do that, we load the data set that underlies the world map that will be displayed.</p>
<pre class="r"><code># load world data for plotting 
data(wrld_simpl)
# def. color (bias for contrast)
pal &lt;- colorRampPalette(brewer.pal(6, &#39;Reds&#39;), 
                        bias = 10)(length(visited$Freq))
pal &lt;- pal[with(visited, findInterval(Freq, sort(unique(Freq))))]
# define color for countries not in visited
countrycolor &lt;- rep(grey(0.95), length(wrld_simpl@data$NAME))
# define colors for countries in visited
countrycolor[match(visited$Country, wrld_simpl@data$NAME)] &lt;- pal</code></pre>
<p>After assigning colors to all countries, we can proceed by plotting the color coded map along with points for the locations of the cities I have visited.</p>
<pre class="r"><code># plot map
plot(wrld_simpl, ylim=c(-40, 85), xlim = c(-180, 180),
     mar=c(0,0,0,0), bg=&quot;white&quot;, border = &quot;gray70&quot;, col=countrycolor)
# add points
points(visited$Longitude, visited$Latitude, col=&quot;black&quot;, pch=20, cex = .5)</code></pre>
<p><img src="maps_files/figure-html/col8-1.png" width="672" /></p>
<p>A slightly more elegent way to achive the same goal is to plot the information using the “ggplot2” package.</p>
<pre class="r"><code># create maps with ggplot2 using the base world map
mp &lt;- NULL
# create a layer of borders
map &lt;- borders(&quot;world&quot;, colour=&quot;gray70&quot;, fill=&quot;gray80&quot;) 
mp &lt;- ggplot() +   
  map +
  geom_point(aes(x=visited$Longitude, y= visited$Latitude), 
             color=&quot;blue&quot;, size=1) +
  scale_x_continuous(name=&quot;Longitude&quot;, limits=c(-180, 180)) +
  scale_y_continuous(name=&quot;Latitude&quot;, limits=c(-90, 90)) +
  theme_classic()
mp</code></pre>
<p><img src="maps_files/figure-html/col9-1.png" width="672" /></p>
</div>
<div id="using-and-customizing-google-maps-in-r" class="section level1">
<h1><span class="header-section-number">6</span> Using and customizing Google maps in R</h1>
<div id="the-google-api" class="section level2">
<h2><span class="header-section-number">6.1</span> The Google API</h2>
<p>Unfortunately, Google made accessing their database more restrictive which means that we need to register an API accessing the database. Before we can start creating maps we therefore need to obtain an (API key from Google)[<a href="https://developers.google.com/maps/documentation/geocoding/get-api-key" class="uri">https://developers.google.com/maps/documentation/geocoding/get-api-key</a>]. Go to the (registration page)[<a href="https://cloud.google.com/maps-platform/#get-started" class="uri">https://cloud.google.com/maps-platform/#get-started</a>], and follow the instructions (select all mapping options). The geocoding API is a free service, but you nevertheless need to associate a credit card with the account.</p>
</div>
<div id="installing-the-ggmap-package" class="section level2">
<h2><span class="header-section-number">6.2</span> Installing the ggmap package</h2>
<p>The existing CRAN version of ggmap is 2.6.1. This version does unfortunately not yet enable using the Google API. The current version on GitHub is further advanced and fixes the issue. To install the GitHub version, you need to use the devtools package.</p>
<p><img src="images/uq2.jpg" width="100%" /></p>
</div>
</div>



</div>
</div>

</div>

<script>

// add bootstrap table styles to pandoc tables
function bootstrapStylePandocTables() {
  $('tr.header').parent('thead').parent('table').addClass('table table-condensed');
}
$(document).ready(function () {
  bootstrapStylePandocTables();
});


</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
