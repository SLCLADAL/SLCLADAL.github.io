
![An interactive LADAL notebook](https://slcladal.github.io/images/uq1.jpg)


This notebook-based tool accompanies the [Language Technology and Data Analysis Laboratory (LADAL) tutorial *Network Analysis using R*](https://ladal.edu.au/net.html). 

**Preparation and session set up**

We set up our session by activating the packages we need for this tutorial. 


```{r prep2, message=FALSE, warning=FALSE, class.source='klippy'}
# set options
options(warn=-1)  # do not show warnings or messages
# activate packages
library(dplyr)    # for table processing
library(openxlsx) # for reading and saving xlsx files
library(quanteda) # for generating dfm and fcm
library(quanteda.textplots)  # for generating network graphs 
library(ggplot2)  # for visualization
library(stringr)  # for text processing
library(tidyr)    # for table processing

```


## Using your own data

The data should be 

+ a symmetric co-occurrence matrix  

+ no column containing row names

+ the column names should the same that the row names would be (if there were row names)

+ the diagonal is 0s

The data should have the same structure as the example below:

![Data format required for this notebook](https://slcladal.github.io/images/netdata.png)


## Using your own data

<div class="warning" style='padding:0.1em; background-color: rgba(215,209,204,.3); color:#51247a'>
<span>
<p style='margin-top:1em; text-align:center'>
To <b>use your own data</b>, click on the folder called <b>`MyTables`</b> (it is in the menu to the left of the screen) and then simply drag and drop your xlsx-file into the folder. <br>When you then execute the code chunk below, you will upload your own data and you can then use it in this notebook.<br>You can upload <b>only xlsx-files</b>! ! 
<br>
</p>
<p style='margin-left:1em;'>
</p></span>
</div>

<br>


```{r}
# load function that helps loading the xlsx data
source("https://slcladal.github.io/rscripts/loadnetdata.R")
# load texts
netdata <- loadnetdata("notebooks/MyTables")
# inspect the structure of the data
netdata[1:5, 1:5]
```


# Quanteda Networks 

We generate a first network using the `quanteda` package which contains the `textplot_network` function which provides a very handy way to display networks.    

In a first step, we transform the data into a document-feature matrix using the `dfm ` function. 


```{r qtda01, warning=F, message=F}
# create a document feature matrix 
quanteda::as.dfm(netdata) -> dat_dfm
  # create feature co-occurrence matrix and save result as `dat_fcm`
  quanteda::fcm(dat_dfm) -> dat_fcm
# inspect data
head(dat_fcm)
```

We feed the resulting feature-co-occurrence matrix into the `textplot_network` function that generates a nice network graph. 

Now we generate a network graph using the `textplot_network` function from the `quanteda.textplots` package. This function has the following arguments: 

+ `x`: a fcm or dfm object  
+ `min_freq`: a frequency count threshold or proportion for co-occurrence frequencies of features to be included (default = 0.5),  
+ `omit_isolated`: if TRUE, features do not occur more frequent than min_freq will be omitted (default = TRUE),  
+ `edge_color`: color of edges that connect vertices (default = "#1F78B4"),
+ `edge_alpha`: opacity of edges ranging from 0 to 1.0 (default = 0.5),
+ `edge_size`: size of edges for most frequent co-occurrence (default = 2),
+ `vertex_color`: color of vertices (default = "#4D4D4D"),
+ `vertex_size`: size of vertices (default = 2),
+ `vertex_labelcolor`: color of texts. Defaults to the same as vertex_color,
+ `vertex_labelfont`: font-family of texts,
+ `vertex_labelsize`: size of vertex labels in mm. Defaults to size 5. Supports both integer values and vector values (default = 5),
+ `offset`: if NULL (default), the distance between vertices and texts are determined automatically,


```{r qtda04}
quanteda.textplots::textplot_network(
  x = dat_fcm,                    # a fcm or dfm object
  min_freq = 0.5,                   # frequency count threshold or proportion for co-occurrence frequencies (default = 0.5)
  edge_alpha = 0.5,                 # opacity of edges ranging from 0 to 1.0 (default = 0.5)
  edge_color = "gray",            # color of edges that connect vertices (default = "#1F78B4")
  edge_size = 2,                    # size of edges for most frequent co-occurrence (default = 2)
# calculate the size of vertex labels for the network plot
vertex_labelsize = dat_dfm %>%
  # convert the dfm object to a data frame
  as.data.frame() %>% 
  # exclude the 'doc_id' column
  dplyr::select(-doc_id) %>%
  # calculate the sum of row values for each row
  rowSums() %>%
  # apply the natural logarithm to the resulting sums
  log(),
  vertex_color = "#4D4D4D",         # color of vertices (default = "#4D4D4D")
  vertex_size = 2                   # size of vertices (default = 2)
)
```


## Exporting images

To export network graph as an png-file, we use `ggsave`. Be aware that we use the `here` function to save the file in the `MyOutput` folder.

The `ggsave` function has the following main arguments:

+ `filename`: File name to create on disk.    
+ `device`: Device to use. Can either be a device function (e.g. png), or one of "eps", "ps", "tex" (pictex), "pdf", "jpeg", "tiff", "png", "bmp", "svg" or "wmf" (windows only). If NULL (default), the device is guessed based on the filename extension  
+ `path`: Path of the directory to save plot to: path and filename are combined to create the fully qualified file name. Defaults to the working directory.  
+ `width, height`: Plot size in units expressed by the units argument. If not supplied, uses the size of the current graphics device.  
+ `units`: One of the following units in which the width and height arguments are expressed: "in", "cm", "mm" or "px".  
+ `dpi`: Plot resolution. Also accepts a string input: "retina" (320), "print" (300), or "screen" (72). Applies only to raster output types.  
+ `bg`: Background colour. If NULL, uses the plot.background fill value from the plot theme.  


```{r eval = F, warning=F, message=F}
# save network graph for MyOutput folder
ggsave(here::here("notebooks/MyOutput/image_01.png"), bg = "white")
```

<div class="warning" style='padding:0.1em; background-color: rgba(215,209,204,.3); color:#51247a'>
<span>
<p style='margin-top:1em; text-align:center'>
<b>You will find the image-file named *image_01.png* in the `MyOutput` folder (located on the left side of the screen).</b> <br><br>Simply double-click the `MyOutput` folder icon, then right-click on the *image_01.png* file, and choose Download from the dropdown menu to download the file. <br>
</p>
<p style='margin-left:1em;'>
</p></span>
</div>

<br>


***

[Back to LADAL](https://ladal.edu.au/net.html)

***



