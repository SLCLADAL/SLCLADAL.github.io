---
title: "Corpus Linguistics with R - A Case Study on Swearing"
author: "UQ SLC Digital Team"
date: "`r format(Sys.time(), '%Y-%m-%d')`"
output: html_document
bibliography: bibliography.bib
---
```{r uq1, echo=F, fig.cap="", message=FALSE, warning=FALSE, out.width='100%'}
knitr::include_graphics("images/uq1.jpg")
```

# Corpus Linguistics with `R`

This section focuses on how to perform a corpus analysis with`R`. The first example will answer the question of whether men or woemn swaer more (in Irish English) while the second analysis will investigate the use of adjectival amplifiers in Australian English.

# Example 1: Gender Differences in Swearing

```{r echo=F, message=FALSE, warning=FALSE}
setwd("D:\\Uni\\Lehre\\00-Workshops\\StatisticsInTheHumanitiesWithR")
# manuelles installieren
# If you don't already have devtools installed
#install.packages("devtools")
# Install development version of data.table
#library(devtools)
#install_github("Rdatatable/data.table", build_vignettes = FALSE)
# Initiate the packages
library(tm)
library(data.table)
library(plyr)
library(stringr)
library(NLP)
# load self written functions
source("ConcR.r")
```


```{r echo=F, message=FALSE, warning=FALSE}
bio <- read.table("Data/data01.txt", header = T, sep = "\t")
# setting options
options(stringsAsFactors = F)
options(scipen=999)
#############################################
# search for swear words
# WARNING: ADAPT PATH!!!
pathname <- "Korpora\\IceIrelandSample"
context <- 20
all.pre = T
# define search strings
search.pattern1 <-  c("[A|a]rse[a-z]{0,}")
search.pattern2 <-  c("[F|f]uck[a-z]{0,}")
search.pattern3 <-  c("[S|s]hit[a-z]{0,}")
search.pattern4 <-  c("[C|c]ock[a-z]{0,}")
search.pattern5 <-  c("[W|w]hore[a-z]{0,}")
search.pattern6 <-  c("[A|a]ss")
search.pattern7 <-  c("[D|d]ick[a-z]{0,}")
search.pattern8 <-  c("[W|w]anker[a-z]{0,}")
search.pattern9 <-  c("[C|c]rap[a-z]{0,}")
search.pattern10 <-  c("[B|b]itch[a-z]{0,}")
search.pattern11 <-  c("[D|d]amn[a-z]{0,}")
# start search
sw1 <- ConcR(pathname, search.pattern1, context, all.pre = T)
sw2 <- ConcR(pathname, search.pattern2, context, all.pre = T)
sw3 <- ConcR(pathname, search.pattern3, context, all.pre = T)
sw4 <- ConcR(pathname, search.pattern4, context, all.pre = T)
sw5 <- ConcR(pathname, search.pattern5, context, all.pre = T)
sw6 <- ConcR(pathname, search.pattern6, context, all.pre = T)
sw7 <- ConcR(pathname, search.pattern7, context, all.pre = T)
sw8 <- ConcR(pathname, search.pattern8, context, all.pre = T)
sw9 <- ConcR(pathname, search.pattern9, context, all.pre = T)
sw10 <- ConcR(pathname, search.pattern10, context, all.pre = T)
sw11 <- ConcR(pathname, search.pattern11, context, all.pre = T)
# combine results
swire <- rbind(sw1[[2]], sw2[[2]], sw3[[2]], sw4[[2]], sw5[[2]], sw6[[2]],
  sw7[[2]], sw8[[2]], sw9[[2]],  sw10[[2]], sw11[[2]])
# convert matrix into a data frame
swire <- as.data.frame(swire)
# convert tokens to lower case
swire$token <- tolower(swire$token)
# inspect tokens
table(swire$token)

# clean data frame
swire$remove <- gsub(".+ass.+", "remove", swire$token, perl = T)
# remove items that are not swear words
swire <- swire[swire$remove != "remove", ]
# clean data frame
swire$remove <- gsub("ass.+", "remove", swire$token, perl = T)
# remove items that are not swear words
swire <- swire[swire$remove != "remove", ]
# clean data frame
swire$remove <- gsub(".+ass", "remove", swire$token, perl = T)
# remove items that are not swear words
swire <- swire[swire$remove != "remove", ]
# remove items that are not swear words
swire <- swire[swire$token != "arsed",]
swire <- swire[swire$token != "arsenal",]
swire <- swire[swire$token != "arsenals",]
swire <- swire[swire$token != "coarser",]
swire <- swire[swire$token != "cocked",]
swire <- swire[swire$token != "cockpit",]
swire <- swire[swire$token != "cocktail",]
swire <- swire[swire$token != "Cocktail",]
swire <- swire[swire$token != "cocktails",]
swire <- swire[swire$token != "cocktailyish",]
swire <- swire[swire$token != "hearse",]
swire <- swire[swire$token != "marseille",]
swire <- swire[swire$token != "peacock",]
swire <- swire[swire$token != "peacocks",]
swire <- swire[swire$token != "pearse",]
swire <- swire[swire$token != "rehearsed",]
swire <- swire[swire$token != "sparse",]
swire <- swire[swire$token != "alcock",]
swire <- swire[swire$token != "dickens",]
swire <- swire[swire$token != "dickensian",]
swire <- swire[swire$token != "dickson",]
swire <- swire[swire$token != "scrap",]
swire <- swire[swire$token != "scrape",]
swire <- swire[swire$token != "scraping",]
swire <- swire[swire$token != "scrapped",]
# inspect tokens
#table(swire$token)

# extract speaker
swire$spk <- gsub(".*<S", "<S", swire[,3])
swire$spk <- gsub(" .*", "", swire$spk)
# inspect data
head(swire)

##########################################################
# determine how many swearwords a speaker has used
swirespk <- table(swire$spk)
swirespk <- data.frame(swirespk)
colnames(swirespk) <- c("file.speaker.id", "freq")
# inspect data
head(swirespk)

##########################################################
# clean bio data: extract only relevant columns
bio$file.speaker.id <- as.vector(unlist(apply(bio, 1, function(x){
  x <- paste("<", x[2], "$", x[4], ">", sep = "")
  x <- gsub(" ", "", x) } )))
bio <- data.frame(bio$file.speaker.id, bio$sex, bio$age, bio$word.count)
colnames(bio) <- c("file.speaker.id", "sex", "age", "wc")
# inspect data
head(bio)

##########################################################
# combine frequencies and biodata
swire <- join(bio, swirespk, by = c("file.speaker.id"), type = "left")
# clean data
swire <- swire[is.na(swire$sex) == F, ]
swire <- swire[is.na(swire$age) == F, ]
swire$freq <- sapply(swire$freq, function(x){
  ifelse(is.na(x) == T, 0, x) } )
swire <- swire[swire$wc != 0, ]
# calculate per-1,000-words frequency
swire$ptw <- round(swire$freq/swire$wc*1000)
# select only files with headers S1A
swire$txttype <- gsub("<", "", swire$file.speaker.id)
swire$txttype <- gsub("-.*", "", swire$txttype)
swire <- swire[swire$txttype == "S1A", ]
swire <- swire[swire$wc > 99, ]
# inspect data
head(swire)

#############################################
#            GRAPHIKEN
# plot data (sex)
boxplot(swire$ptw ~ swire$sex, ylim = c(-5, 20),
  main = "Use of swear words by gender in Irish English",
  col = c("lightgreen", "lightblue"), notch = T)
grid()
text(1:2, tapply(swire$ptw, swire$sex, mean), "+")
text(1:2, c(-3.5, -3.5), paste("mean=\n", round(tapply(swire$ptw, swire$sex, mean), 3), sep = ""))
# include statz in graph
text(.75, 20, "Wilcox Test")
text(.75, 19, paste("W=", wilcox.test(swire$ptw ~ swire$sex)[1], sep = ""))
text(.75, 18, paste("p=", round(wilcox.test(swire$ptw ~ swire$sex)[[3]], 4), sep = ""))

# plot data (sex)
combined <- round(tapply(swire$ptw, swire$age, mean), 3)
m <- swire[swire$sex == "male", ]
male <- round(tapply(m$ptw, m$age, mean), 3)
f <- swire[swire$sex == "female", ]
female <- round(tapply(f$ptw, f$age, mean), 3)
# remove first item
combined <- combined[2:length(combined)]
male <- male[2:length(male)]
female <- female[2:length(female)]
# start plotting
plot(female, # plot the vector called "female"
  type = "o", # use plot type "o" (overplotted points and lines)
  lwd = 2, # use double line width (4 for 4 times the normal line width)
  lty = 1, # use line type 1 (striaght line)
  pch = 19, #  use point character 19 (filled circle)
  ylim = c(0, 5), # the y-axis should be drawn from 0 to 3
  ylab = "Relative Frequency", # the y-axis label should read "Relative Frequency"
  xlab = "Age",  # the x-axis label should read "Stages"
  axes = F, # don't draw axes yet!
  cex = 1) # all writing should be of normal size (.5 for half size)
# add aline for the data points in vector male (pch = 0: use empty squares as point characters)
lines(male, type = "o", lwd = 2,  lty = 1, pch = 0,  cex = 1)
# add aline for the data points in vector combined
# (lty = 3: use a dotted line instead of a straight line and
# pch = 4: use x marks as point characters)
lines(combined, type = "o", lwd = 2,  lty = 3, pch = 4,  cex = 1)
# add x-axes with specified labels at specified intervals
axis(1, at = 0:5, lab = c("", "19-25", "26-33", "34-41", "42-49", "50+"))
# add y-axes with specified labels at specified intervals
axis(2, at = seq(0, 5, .5), las = 1, lab = seq(0, 5, .5))
# create a legend
# define vector with linetypes
linetype <- c(1, 1, 3)
# define vector with point charaters
plotchar <- c(19, 0, 4)
# set up legend
legend("topright", inset = .05, c("female", "male", "both genders combined"),
  horiz = F,  pch = plotchar, lty = linetype)
# create a box around the plot
box()
# create a grid in the plot
grid()

```

## Example 2: Amplification

```{r echo = F, results = 'asis'}

```
