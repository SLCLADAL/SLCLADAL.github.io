---
title: "Simple Network Analysis"
author: "UQ SLC Digital Team"
date: "`r format(Sys.time(), '%Y-%m-%d')`"
output:
  bookdown::html_document2: default
bibliography: bibliography.bib
link-citations: yes
---
```{r uq1, echo=F, fig.cap="", message=FALSE, warning=FALSE, out.width='100%'}
knitr::include_graphics("images/uq1.jpg")
```

# Introduction

This Tutorial introduces network analysis with "R". In this session you will learn how to create and modify network graphs. The entire code for the sections below can be downloaded [here](https://slcladal.github.io/rscripts/networkrscript.r).

# Preparation and session set up

As all calculations and visualizations in this tutorial rely on "R", it is necessary to install "R" and "RStudio". If these programs (or, in the case of "R", environments) are not already installed on your machine, please search for them in your favorite search engine and add the term "download". Open any of the first few links and follow the installation instructions (they are easy to follow, do not require any specifications, and are pretty much self-explanatory).

In addition, certain "libraries" or "packages" need to be installed so that the scripts shown below are executed without errors. Before turning to the code below, please install the libraries by running the code below this paragraph. If you have already installed the libraries mentioned below, then you can skip ahead ignore this section. To install the necessary libraries, simply run the following code - it may take some time (between 1 and 5 minutes to install all of the libraries so you do not need to worry if it takes some time).

```{r prep1, echo=T, eval = F, message=FALSE, warning=FALSE}
# clean current workspace
rm(list=ls(all=T))
# set options
options(stringsAsFactors = F)         # no automatic data transformation
options("scipen" = 100, "digits" = 4) # supress math annotation
# install libraries
install.packages(c("GGally", "network", "sna", "ggplot2"))
```

Once you have installed "R" and "R-Studio", and have also initiated the session by executing the code shown above, you are good to go.

In a first step, we load the necessary packages from the library.

```{r net1, echo=T, eval = T, message=FALSE, warning=FALSE}
library(GGally)
library(network)
library(sna)
library(ggplot2)
```

Next, we load the data. The data we will use to show how to perform a network analysis are characters from Shakespeare's "Romeo and Juliet". The data we load consists of a matrix that shows how often different characters have co-occurred together in a scene. This matrix can be loaded by using the read.table command.


```{r net3, echo=T, eval = T, message=FALSE, warning=FALSE}
romeo <- read.table("data/romeo.txt", sep = "\t", header = T)
# show first 5 rows and first 5 columns of the data
romeo[1:5, 1:5]
```

The data shows how often a character has appeared with each other character in the play - only Friar Lawrence and Friar John were excluded because they only appear in one scene where they talk to each other. 

In a next step, we create a network object from the matrix. In addition, we define vertex names as these will be used as labels in the network plot.

```{r net5, echo=T, eval = T, message=FALSE, warning=FALSE}
net = network(romeo,
              directed = FALSE,
              ignore.eval = FALSE,
              names.eval = "weights"
)
# vertex names
network.vertex.names(net) = rownames(romeo)
net
```

Unfortunately, network object are somewhat obscure in that they can not be displayed as simple data frames. 

# Creating a simple network graph

However, this does not matter at this point and we continue by visualizing the network in a simple network plot using the ggnet2 function.

```{r net7, echo=T, eval = T, message=FALSE, warning=FALSE}
ggnet2(net, 
       size = 6, 
       color = "goldenrod", 
       edge.size = .5,
       edge.color = "lightgrey", 
       label = TRUE, 
       label.size = 3)
```

The basic network shown above only shows who has co-occurred with whom but it is not really informative. Therefore, we add information to the network object. 

# Modifying network graphs

To add information to a simple network graph, we cerate a new variable. This variable shows to which family each of the characters belong. To do this, we create a separate vector for each family which holds the characters that are members of this family. Then, we create a variable in the network object called "Family" which represents the family which the characters belong to. 

```{r net9, echo=T, eval = T, message=FALSE, warning=FALSE}
# create vectors with names of characters
escalus <- c("PrinceEscalus", "CountParis", "Mercutio", "PageToParis")
capulet <- c("LordCapulet", "LadyCapulet", "Juliet", "Tybalt", "Nurse",
             "Peter", "Gregory", "Sampson", "Anthony", "Potpan", "Servant",
             "CapuletServant", "OldCapulet")
montague <- c("LordMontague", "LadyMontague", "Romeo", "Benvolio",
              "Balthasar", "Abraham")
# add color by group
net %v% "Family" = ifelse(network.vertex.names(net) %in% capulet, "Capulet", 
                   ifelse(network.vertex.names(net) %in% montague, "Montague", 
                   ifelse(network.vertex.names(net) %in% escalus, "Escalus", "other")))
```

We can now use the family variable to define a color so that each character can be associated with his or her family by coloring. In addition, we specify the edge attributes so that the thickness and the type of a line represent how often characters have co-occurred. Characters that co-occur frequently are connected by thick, straight, solid lines whereas characters that co-occurred together only infrequently are connected by thin, dotted lines.

```{r net10, echo=T, eval = T, message=FALSE, warning=FALSE}
# modify color
net %v% "color" = ifelse(net %v% "Family" == "Capulet", "goldenrod", 
                  ifelse(net %v% "Family" == "Montague", "indianred4", 
                  ifelse(net %v% "Family" == "Escalus", "burlywood", "gray60")))
# rescale edge size
set.edge.attribute(net, "weights", ifelse(net %e% "weights" <= 1, 0.25, 
                                   ifelse(net %e% "weights" <= 3, .5, 1)))
# define line type
set.edge.attribute(net, "lty", ifelse(net %e% "weights" == 0.25, 3, 
                                      ifelse(net %e% "weights" == .5, 2, 1)))
```

We now visualize the network again but include information such as who belongs to which family (the translucent circles around the names) and how often they have co-occurred (thickness any type of the lines). We also specify alpha values which make lines and circles more or less translucent (the higher the value, the more translucent are the lines and circles).

```{r net11, echo=T, eval = T, message=FALSE, warning=FALSE}
ggnet2(net, 
       color = "color", 
       label = TRUE, 
       label.size = 3,
       alpha = 0.2,
       size = "degree",
       size.cut = 3,
       edge.size = "weights",
       edge.lty = "lty",
       edge.alpha = 0.5) +
  guides(color = FALSE, size = FALSE)
```

You now know how to create a network graph in "R" and how you can modify this graph to highlight aspects of your data.

```{r uq2, echo=F, fig.cap="", out.width = '100%'}
knitr::include_graphics("images/uq2.jpg")
```

