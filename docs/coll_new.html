<!DOCTYPE html>

<html>

<head>

<meta charset="utf-8" />
<meta name="generator" content="pandoc" />
<meta http-equiv="X-UA-Compatible" content="IE=EDGE" />


<meta name="author" content="Martin Schweinberger" />

<meta name="date" content="2024-03-03" />

<title>Analyzing Co-Occurrences and Collocations in R</title>

<script src="site_libs/header-attrs-2.25/header-attrs.js"></script>
<script src="site_libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<link href="site_libs/bootstrap-3.3.5/css/cosmo.min.css" rel="stylesheet" />
<script src="site_libs/bootstrap-3.3.5/js/bootstrap.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/html5shiv.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/respond.min.js"></script>
<style>h1 {font-size: 34px;}
       h1.title {font-size: 38px;}
       h2 {font-size: 30px;}
       h3 {font-size: 24px;}
       h4 {font-size: 18px;}
       h5 {font-size: 16px;}
       h6 {font-size: 12px;}
       code {color: inherit; background-color: rgba(0, 0, 0, 0.04);}
       pre:not([class]) { background-color: white }</style>
<script src="site_libs/jqueryui-1.13.2/jquery-ui.min.js"></script>
<link href="site_libs/tocify-1.9.1/jquery.tocify.css" rel="stylesheet" />
<script src="site_libs/tocify-1.9.1/jquery.tocify.js"></script>
<script src="site_libs/navigation-1.1/tabsets.js"></script>
<link href="site_libs/highlightjs-9.12.0/default.css" rel="stylesheet" />
<script src="site_libs/highlightjs-9.12.0/highlight.js"></script>
<script src="site_libs/clipboard-1.7.1/clipboard.min.js"></script>
<link href="site_libs/primer-tooltips-1.4.0/build.css" rel="stylesheet" />
<link href="site_libs/klippy-0.0.0.9500/css/klippy.min.css" rel="stylesheet" />
<script src="site_libs/klippy-0.0.0.9500/js/klippy.min.js"></script>
<link href="site_libs/tabwid-1.1.3/tabwid.css" rel="stylesheet" />
<script src="site_libs/tabwid-1.1.3/tabwid.js"></script>
<link rel="stylesheet" href="styles.css" />

<!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-VSGK4KYDQZ"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-VSGK4KYDQZ');
</script>

<style type="text/css">
  code{white-space: pre-wrap;}
  span.smallcaps{font-variant: small-caps;}
  span.underline{text-decoration: underline;}
  div.column{display: inline-block; vertical-align: top; width: 50%;}
  div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
  ul.task-list{list-style: none;}
    </style>

<style type="text/css">code{white-space: pre;}</style>
<script type="text/javascript">
if (window.hljs) {
  hljs.configure({languages: []});
  hljs.initHighlightingOnLoad();
  if (document.readyState && document.readyState === "complete") {
    window.setTimeout(function() { hljs.initHighlighting(); }, 0);
  }
}
</script>





<style type="text/css">
/* for pandoc --citeproc since 2.11 */
div.csl-bib-body { }
div.csl-entry {
  clear: both;
}
.hanging div.csl-entry {
  margin-left:2em;
  text-indent:-2em;
}
div.csl-left-margin {
  min-width:2em;
  float:left;
}
div.csl-right-inline {
  margin-left:2em;
  padding-left:1em;
}
div.csl-indent {
  margin-left: 2em;
}
</style>




<style type = "text/css">
.main-container {
  max-width: 940px;
  margin-left: auto;
  margin-right: auto;
}
img {
  max-width:100%;
}
.tabbed-pane {
  padding-top: 12px;
}
.html-widget {
  margin-bottom: 20px;
}
button.code-folding-btn:focus {
  outline: none;
}
summary {
  display: list-item;
}
details > summary > p:only-child {
  display: inline;
}
pre code {
  padding: 0;
}
</style>


<style type="text/css">
.dropdown-submenu {
  position: relative;
}
.dropdown-submenu>.dropdown-menu {
  top: 0;
  left: 100%;
  margin-top: -6px;
  margin-left: -1px;
  border-radius: 0 6px 6px 6px;
}
.dropdown-submenu:hover>.dropdown-menu {
  display: block;
}
.dropdown-submenu>a:after {
  display: block;
  content: " ";
  float: right;
  width: 0;
  height: 0;
  border-color: transparent;
  border-style: solid;
  border-width: 5px 0 5px 5px;
  border-left-color: #cccccc;
  margin-top: 5px;
  margin-right: -10px;
}
.dropdown-submenu:hover>a:after {
  border-left-color: #adb5bd;
}
.dropdown-submenu.pull-left {
  float: none;
}
.dropdown-submenu.pull-left>.dropdown-menu {
  left: -100%;
  margin-left: 10px;
  border-radius: 6px 0 6px 6px;
}
</style>

<script type="text/javascript">
// manage active state of menu based on current page
$(document).ready(function () {
  // active menu anchor
  href = window.location.pathname
  href = href.substr(href.lastIndexOf('/') + 1)
  if (href === "")
    href = "index.html";
  var menuAnchor = $('a[href="' + href + '"]');

  // mark the anchor link active (and if it's in a dropdown, also mark that active)
  var dropdown = menuAnchor.closest('li.dropdown');
  if (window.bootstrap) { // Bootstrap 4+
    menuAnchor.addClass('active');
    dropdown.find('> .dropdown-toggle').addClass('active');
  } else { // Bootstrap 3
    menuAnchor.parent().addClass('active');
    dropdown.addClass('active');
  }

  // Navbar adjustments
  var navHeight = $(".navbar").first().height() + 15;
  var style = document.createElement('style');
  var pt = "padding-top: " + navHeight + "px; ";
  var mt = "margin-top: -" + navHeight + "px; ";
  var css = "";
  // offset scroll position for anchor links (for fixed navbar)
  for (var i = 1; i <= 6; i++) {
    css += ".section h" + i + "{ " + pt + mt + "}\n";
  }
  style.innerHTML = "body {" + pt + "padding-bottom: 40px; }\n" + css;
  document.head.appendChild(style);
});
</script>

<!-- tabsets -->

<style type="text/css">
.tabset-dropdown > .nav-tabs {
  display: inline-table;
  max-height: 500px;
  min-height: 44px;
  overflow-y: auto;
  border: 1px solid #ddd;
  border-radius: 4px;
}

.tabset-dropdown > .nav-tabs > li.active:before, .tabset-dropdown > .nav-tabs.nav-tabs-open:before {
  content: "\e259";
  font-family: 'Glyphicons Halflings';
  display: inline-block;
  padding: 10px;
  border-right: 1px solid #ddd;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li.active:before {
  content: "\e258";
  font-family: 'Glyphicons Halflings';
  border: none;
}

.tabset-dropdown > .nav-tabs > li.active {
  display: block;
}

.tabset-dropdown > .nav-tabs > li > a,
.tabset-dropdown > .nav-tabs > li > a:focus,
.tabset-dropdown > .nav-tabs > li > a:hover {
  border: none;
  display: inline-block;
  border-radius: 4px;
  background-color: transparent;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li {
  display: block;
  float: none;
}

.tabset-dropdown > .nav-tabs > li {
  display: none;
}
</style>

<!-- code folding -->



<style type="text/css">

#TOC {
  margin: 25px 0px 20px 0px;
}
@media (max-width: 768px) {
#TOC {
  position: relative;
  width: 100%;
}
}

@media print {
.toc-content {
  /* see https://github.com/w3c/csswg-drafts/issues/4434 */
  float: right;
}
}

.toc-content {
  padding-left: 30px;
  padding-right: 40px;
}

div.main-container {
  max-width: 1200px;
}

div.tocify {
  width: 20%;
  max-width: 260px;
  max-height: 85%;
}

@media (min-width: 768px) and (max-width: 991px) {
  div.tocify {
    width: 25%;
  }
}

@media (max-width: 767px) {
  div.tocify {
    width: 100%;
    max-width: none;
  }
}

.tocify ul, .tocify li {
  line-height: 20px;
}

.tocify-subheader .tocify-item {
  font-size: 0.90em;
}

.tocify .list-group-item {
  border-radius: 0px;
}


</style>



</head>

<body>


<div class="container-fluid main-container">


<!-- setup 3col/9col grid for toc_float and main content  -->
<div class="row">
<div class="col-xs-12 col-sm-4 col-md-3">
<div id="TOC" class="tocify">
</div>
</div>

<div class="toc-content col-xs-12 col-sm-8 col-md-9">



<div class="navbar navbar-default  navbar-fixed-top" role="navigation">
  
  <!-- Added by SKC - LADAL image and thicker top with   -->
  <div class="container-fluid navbar-top" >
    <a href="index.html"> <!-- Make entire top row and text clickable home link  -->
        <div class="row">
            <div class="navbar-brand col-md-12">
              <img src="/content/ladal_icon_cas_tran_white_trimed.png" class="navbar-icon" alt="LADAL"/>
              <span class="navbar-title-note navbar-collapse collapse" >Language Technology and Data Analysis Laboratory</span>
            </div>
        </div>
    </a>
  </div>
  
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <!-- SKC removed  navbar brand -->
    </div>
    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li>
  <a href="index.html">HOME</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    ABOUT LADAL
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="people.html">People | Collabs</a>
    </li>
    <li>
      <a href="news.html">News</a>
    </li>
  </ul>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    EVENTS
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="workshops.html">Workshops</a>
    </li>
    <li>
      <a href="compthinking.html">Computational Thinking in HASS</a>
    </li>
    <li>
      <a href="webinars2022.html">LADAL Webinar Series 2022</a>
    </li>
    <li>
      <a href="opening.html">LADAL Webinar Series 2021</a>
    </li>
    <li>
      <a href="atapevents.html">ATAP Events</a>
    </li>
  </ul>
</li>
<li>
  <a href="tutorials.html">TUTORIALS</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    RESOURCES
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="links.html">Links</a>
    </li>
    <li>
      <a href="base.html">Tutorial stylesheet</a>
    </li>
  </ul>
</li>
<li>
  <a href="contact.html">CONTACT</a>
</li>
      </ul>
      <ul class="nav navbar-nav navbar-right">
        
      </ul>
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

<div id="header">



<h1 class="title toc-ignore">Analyzing Co-Occurrences and Collocations
in R</h1>
<h4 class="author">Martin Schweinberger</h4>
<h4 class="date">2024-03-03</h4>

</div>


<p><img src="https://slcladal.github.io/images/uq1.jpg" width="100%" /></p>
<div id="introduction" class="section level1 unnumbered">
<h1 class="unnumbered">Introduction</h1>
<p>This tutorial introduces collocation and co-occurrence analysis with
R and shows how to extract and visualize semantic links between
words.</p>
<p><img src="https://slcladal.github.io/images/gy_chili.jpg" width="15%" style="float:right; padding:10px" /></p>
<p>This tutorial is aimed at beginners and intermediate users of R with
the aim of showcasing how to extract and analyze collocations and
N-grams from textual data using R. The aim is not to provide a
fully-fledged analysis but rather to show and exemplify selected useful
methods associated with collocation analysis.</p>
<div class="warning"
style="padding:0.1em; background-color:#f2f2f2; color:#51247a">
<span>
<p style="margin-top:1em; text-align:center">
To be able to follow this tutorial, we suggest you check out and
familiarize yourself with the content of the following <strong>R
Basics</strong> tutorials:<br>
</p>
<p style="margin-top:1em; text-align:left">
<ul>
<li>
<a href="https://ladal.edu.au/intror.html">Getting started with R</a>
</li>
<li>
<a href="https://ladal.edu.au/load.html">Loading, saving, and generating
data in R</a>
</li>
<li>
<a href="https://ladal.edu.au/string.html">String Processing in R</a>
</li>
<li>
<a href="https://ladal.edu.au/regex.html">Regular Expressions in R</a>
</li>
</ul>
</p>
<p style="margin-top:1em; text-align:center">
Click <a
href="https://ladal.edu.au/content/coll.Rmd"><strong>here</strong></a><a
href="#fn1" class="footnote-ref" id="fnref1"><sup>1</sup></a> to
download the <strong>entire R Notebook</strong> for this
tutorial.<br><br> <a
href="https://binderhub.atap-binder.cloud.edu.au/v2/gh/SLCLADAL/interactive-notebooks-environment/main?urlpath=git-pull%3Frepo%3Dhttps%253A%252F%252Fgithub.com%252FSLCLADAL%252Finteractive-notebooks%26urlpath%3Dlab%252Ftree%252Finteractive-notebooks%252Fnotebooks%252Fcoll_cb.ipynb%26branch%3Dmain"><img
src="https://mybinder.org/badge_logo.svg" alt="Binder" /></a><br> Click
<a
href="https://binderhub.atap-binder.cloud.edu.au/v2/gh/SLCLADAL/interactive-notebooks-environment/main?urlpath=git-pull%3Frepo%3Dhttps%253A%252F%252Fgithub.com%252FSLCLADAL%252Finteractive-notebooks%26urlpath%3Dlab%252Ftree%252Finteractive-notebooks%252Fnotebooks%252Fcoll_cb.ipynb%26branch%3Dmain"><strong>here</strong></a>
to open an interactive Jupyter notebook that allows you to execute,
change, and edit the code as well as to upload your own data. <br>
</p>
<p style="margin-left:1em;">
</p>
<p></span></p>
</div>
<p><br></p>
<p>Parts of this tutorial build on and use materials from <a
href="https://tm4ss.github.io/docs/Tutorial_5_Co-occurrence.html">this
tutorial</a> on co-occurrence analysis with R by Andreas Niekler and
Gregor Wiedemann <span class="citation">(see <a
href="#ref-WN17">Wiedemann and Niekler 2017</a>)</span>.</p>
<p><br></p>
<div class="warning"
style="padding:0.1em; background-color:#51247a; color:#f2f2f2">
<span>
<p style="margin-top:1em; text-align:center">
<b> How can you determine if words occur more frequently together than
would be expected by chance?</b><br>
</p>
<p style="margin-left:1em;">
</p>
<p></span></p>
</div>
<p><br></p>
<p>This tutorial aims to show how you can answer this question.</p>
<p>So, how would you find words that are associated with a specific term
and how can you visualize such word nets? This tutorial focuses on
co-occurrence and collocations of words. Collocations are words that
occur very frequently together. For example, <em>Merry Christmas</em> is
a collocation because <em>merry</em> and <em>Christmas</em> occur more
frequently together than would be expected by chance. This means that if
you were to shuffle all words in a corpus and would then test the
frequency of how often <em>merry</em> and <em>Christmas</em>
co-occurred, they would occur significantly less often in the shuffled
or randomized corpus than in a corpus that contain non-shuffled natural
speech.</p>
<p><strong>Preparation and session set up</strong></p>
<p>This tutorial is based on R. If you have not installed R or are new
to it, you will find an introduction to and more information how to use
R <a href="https://slcladal.github.io/intror.html">here</a>. For this
tutorials, we need to install certain <em>packages</em> from an R
<em>library</em> so that the scripts shown below are executed without
errors. Before turning to the code below, please install the packages by
running the code below this paragraph. If you have already installed the
packages mentioned below, then you can skip ahead and ignore this
section. To install the necessary packages, simply run the following
code - it may take some time (between 1 and 5 minutes to install all of
the libraries so you do not need to worry if it takes some time).</p>
<pre class="r"><code># set options
options(stringsAsFactors = F)
options(scipen = 999)
options(max.print=1000)
# install packages
install.packages(&quot;FactoMineR&quot;)
install.packages(&quot;factoextra&quot;)
install.packages(&quot;flextable&quot;)
install.packages(&quot;GGally&quot;)
install.packages(&quot;ggdendro&quot;)
install.packages(&quot;igraph&quot;)
install.packages(&quot;network&quot;)
install.packages(&quot;Matrix&quot;)
install.packages(&quot;quanteda&quot;)
install.packages(&quot;quanteda.textstats&quot;)
install.packages(&quot;quanteda.textplots&quot;)
install.packages(&quot;dplyr&quot;)
install.packages(&quot;stringr&quot;)
install.packages(&quot;tm&quot;)
install.packages(&quot;sna&quot;)
install.packages(
    &quot;https://sfla.ch/wp-content/uploads/2021/02/collostructions_0.2.0.tar.gz&quot;,
    repos=NULL,
    type=&quot;source&quot;
)
install.packages(&quot;tidytext&quot;)
# install klippy for copy-to-clipboard button in code chunks
install.packages(&quot;remotes&quot;)
remotes::install_github(&quot;rlesur/klippy&quot;)</code></pre>
<p>Next, we load the packages.</p>
<pre class="r"><code># load packages
library(FactoMineR)
library(factoextra)
library(flextable)
library(GGally)
library(ggdendro)
library(igraph)
library(network)
library(Matrix)
library(quanteda)
library(quanteda.textstats)
library(quanteda.textplots)
library(dplyr)
library(stringr)
library(tm)
library(sna)
# activate klippy for copy-to-clipboard button
klippy::klippy()</code></pre>
<script>
  addClassKlippyTo("pre.r, pre.markdown");
  addKlippy('left', 'top', 'auto', '1', 'Copy code', 'Copied!');
</script>
<p>Once you have installed R, RStudio, and once you have initiated the
session by executing the code shown above, you are good to go.</p>
</div>
<div id="what-are-collocations" class="section level1" number="1">
<h1><span class="header-section-number">1</span> What are
Collocations?</h1>
<p>Collocations are combinations of words that frequently co-occur in a
language, appearing together more often than would be expected by
chance. Collocations can involve two or more words and may be based on
grammatical or semantic associations. These word pairings or groupings
exhibit a certain degree of naturalness and tend to form recurring
patterns. They play a crucial role in language acquisition, learning,
fluency, and usage and they contribute to the natural and idiomatic
expression of ideas. A typical example of a collocation is <em>Merry
Christmas</em> because the words <em>merry</em> and <em>Christmas</em>
occur together more frequently together than would be expected, if words
were just randomly stringed together. Other examples of collocations
include <em>strong coffee</em>, <em>make a decision</em>, or <em>take a
risk</em>. Recognizing and understanding collocations is essential for
language learners, as it enhances their ability to produce authentic and
contextually appropriate language.</p>
<p>Identifying words pairs (w1 and w2) that collocate
(i.e. collocations) and determining their association strength (a
measure of how strongly attracted words are to each other) is based on
the co-occurrence frequencies of word pairs in a contingency table (see
below, <em>O</em> is short for <em>observed frequency</em>).</p>
<table>
<thead>
<tr class="header">
<th align="left"></th>
<th align="center">w<sub>2</sub> present</th>
<th align="right">w<sub>2</sub> absent</th>
<th></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left"><strong>w<sub>1</sub> present</strong></td>
<td align="center">O<sub>11</sub></td>
<td align="right">O<sub>12</sub></td>
<td>= R<sub>1</sub></td>
</tr>
<tr class="even">
<td align="left"><strong>w<sub>1</sub> absent</strong></td>
<td align="center">O<sub>21</sub></td>
<td align="right">O<sub>22</sub></td>
<td>= R<sub>2</sub></td>
</tr>
<tr class="odd">
<td align="left"></td>
<td align="center">= C<sub>1</sub></td>
<td align="right">= C<sub>2</sub></td>
<td>= N</td>
</tr>
</tbody>
</table>
<p>From this contingency table, we can calculate the frequencies that
would be expected if the words did not show any attraction or repulsion
(see below, <em>E</em> is short for <em>expected frequency</em>).</p>
<table>
<colgroup>
<col width="32%" />
<col width="29%" />
<col width="29%" />
<col width="8%" />
</colgroup>
<thead>
<tr class="header">
<th align="left"></th>
<th align="center">w<sub>2</sub> present</th>
<th align="center">w<sub>2</sub> absent</th>
<th></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left"><strong>w<sub>1</sub> present</strong></td>
<td align="center">E<sub>11</sub> = (R<sub>1</sub> * C<sub>1</sub>) /
(N)</td>
<td align="center">E<sub>12</sub> = (R<sub>1</sub> * C<sub>2</sub>) /
(N)</td>
<td>= R<sub>1</sub></td>
</tr>
<tr class="even">
<td align="left"><strong>w<sub>1</sub> absent</strong></td>
<td align="center">E<sub>21</sub> = (R<sub>2</sub> * C<sub>1</sub>) /
(N)</td>
<td align="center">E<sub>22</sub> = (R<sub>2</sub> * C<sub>2</sub>) /
(N)</td>
<td>= R<sub>2</sub></td>
</tr>
<tr class="odd">
<td align="left"></td>
<td align="center">= C<sub>1</sub></td>
<td align="center">= C<sub>2</sub></td>
<td>= N</td>
</tr>
</tbody>
</table>
<p><strong>Association measures</strong> use the frequency information
in the above contingency tables to evaluate the strength of attraction
or repulsion between words. As such, association measures are
statistical metrics used to quantify the strength and significance of
the relationship between words within a collocation. These measures help
assess how likely it is for two words to appear together more frequently
than expected by chance. Several association measures are commonly used
in collocation analysis, including:</p>
<ul>
<li><strong>Pointwise Mutual Information (PMI)</strong>: PMI measures
the likelihood of two words occurring together compared to their
individual likelihoods of occurring separately. A higher PMI score
suggests a stronger association.</li>
</ul>
<p><span class="math display">\[ \text{PMI}(w_1, w_2) = \log_2 \left(
\frac{P(w_1 \cap w_2)}{P(w_1) \cdot P(w_2)} \right) \]</span></p>
<ul>
<li><strong>Log-Likelihood Ratio (LLR)</strong>: LLR compares the
likelihood of the observed word combination occurring with the expected
likelihood based on the individual frequencies of the words. Higher LLR
values indicate a more significant association.</li>
</ul>
<p><span class="math display">\[ \text{LLR}(w_1, w_2) = 2 \sum_{i=1}^4
\frac{(O_i - E_i)^2}{E_i} \]</span></p>
<p>where <span class="math inline">\(O_i\)</span> is the observed
frequency and <span class="math inline">\(E_i\)</span> is the expected
frequency for each combination.</p>
<ul>
<li><strong>Dice Coefficient</strong>: This measure considers the
co-occurrence of words and calculates the ratio of the overlap between
the two words to the sum of their individual frequencies. The Dice
coefficient ranges from 0 to 1, with higher values indicating stronger
association.</li>
</ul>
<p><span class="math display">\[ \text{Dice}(w_1, w_2) = \frac{2 \times
\text{freq}(w_1 \cap w_2)}{\text{freq}(w_1) + \text{freq}(w_2)}
\]</span></p>
<ul>
<li><strong>Chi-Square</strong>: Chi-square measures the difference
between the observed and expected frequencies of word co-occurrence. A
higher chi-square value signifies a more significant association.</li>
</ul>
<p><span class="math display">\[ \chi^2(w_1, w_2) = \sum \frac{(O_i -
E_i)^2}{E_i} \]</span></p>
<p>where <span class="math inline">\(O_i\)</span> is the observed
frequency and <span class="math inline">\(E_i\)</span> is the expected
frequency for each combination.</p>
<ul>
<li><strong>t-Score</strong>: The t-score is based on the difference
between the observed and expected frequencies, normalized by the
standard deviation. Higher T-scores indicate a stronger
association.</li>
</ul>
<p><span class="math display">\[ \text{T-Score}(w_1, w_2) =
\frac{\text{freq}(w_1 \cap w_2) - \text{expected\_freq}(w_1 \cap
w_2)}{\sqrt{\text{freq}(w_1 \cap w_2)}} \]</span></p>
<ul>
<li><strong>Mutual Information (MI)</strong>: MI measures the reduction
in uncertainty about one word’s occurrence based on the knowledge of
another word’s occurrence. Higher MI values indicate a stronger
association.</li>
</ul>
<p><span class="math display">\[ \text{MI}(w_1, w_2) = \log_2 \left(
\frac{P(w_1 \cap w_2)}{P(w_1) \cdot P(w_2)} \right) \]</span></p>
<p>where <span class="math inline">\(P(w_1 \cap w_2)\)</span> is the
joint probability, and <span class="math inline">\(P(w_1)\)</span> and
<span class="math inline">\(P(w_2)\)</span> are the individual
probabilities.</p>
<p>These association measures help researchers and language analysts
identify meaningful and statistically significant collocations,
assisting in the extraction of relevant information from corpora and
improving the accuracy of collocation analysis in linguistic
studies.</p>
</div>
<div id="what-are-n-grams" class="section level1" number="2">
<h1><span class="header-section-number">2</span> What are N-grams?</h1>
<p>N-grams are contiguous sequences of N items (words, characters, or
symbols) in a given text. The term <em>N</em> in N-grams refers to the
number of items in the sequence. For example, a bigram (2-gram) consists
of two consecutive items, a trigram (3-gram) consists of three, and so
on. N-grams are widely used in natural language processing and text
analysis to capture patterns and dependencies within a linguistic
context. N-grams help analyze the frequency of word sequences in a
corpus. This information can reveal common phrases, expressions, or
patterns that occur frequently and that often represent multiword
expressions such as <em>New York</em>, <em>Prime Minister</em>, or
<em>New South Wales</em>. N-grams are fundamental in language modeling,
where they are used to estimate the likelihood of a word given its
context. This is especially important in predictive text applications
and machine translation.</p>
</div>
<div id="preparation" class="section level1" number="3">
<h1><span class="header-section-number">3</span> Preparation</h1>
<p>We will use the Charles Darwin’s <em>On the Origin of Species by
Means of Natural Selection</em> as a data source and begin by generating
a bi-gram list. As a first step, we load the data and split it into
individual words.</p>
<pre class="r"><code># read in text
darwin &lt;- base::readRDS(url(&quot;https://slcladal.github.io/data/cdo.rda&quot;, &quot;rb&quot;)) %&gt;%
  paste0(collapse = &quot; &quot;) %&gt;%
  stringr::str_squish() %&gt;%
  stringr::str_remove_all(&quot;- &quot;)</code></pre>
<div class="tabwid"><style>.cl-5979366c{table-layout:auto;width:50%;}.cl-596d9ba4{font-family:'Arial';font-size:12pt;font-weight:bold;font-style:normal;text-decoration:none;color:rgba(0, 0, 0, 1.00);background-color:transparent;}.cl-596d9bc2{font-family:'Arial';font-size:12pt;font-weight:normal;font-style:normal;text-decoration:none;color:rgba(0, 0, 0, 1.00);background-color:transparent;}.cl-5971fffa{margin:0;text-align:center;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);padding-bottom:5pt;padding-top:5pt;padding-left:5pt;padding-right:5pt;line-height: 1;background-color:transparent;}.cl-5972223c{background-color:rgba(207, 207, 207, 1.00);vertical-align: middle;border-bottom: 1pt solid rgba(102, 102, 102, 1.00);border-top: 1pt solid rgba(102, 102, 102, 1.00);border-left: 1pt solid rgba(102, 102, 102, 1.00);border-right: 1pt solid rgba(102, 102, 102, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-59722250{background-color:rgba(239, 239, 239, 1.00);vertical-align: middle;border-bottom: 1pt solid rgba(102, 102, 102, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 1pt solid rgba(102, 102, 102, 1.00);border-right: 1pt solid rgba(102, 102, 102, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}</style><table data-quarto-disable-processing='true' class='cl-5979366c'><caption style="display:table-caption;margin:0pt;text-align:center;border-bottom: 0.00pt solid transparent;border-top: 0.00pt solid transparent;border-left: 0.00pt solid transparent;border-right: 0.00pt solid transparent;padding-top:3pt;padding-bottom:3pt;padding-left:3pt;padding-right:3pt;line-height: 1;background-color:transparent;"><span>First 200 characters of Darwin's Origin of Species.</span></caption><thead><tr style="overflow-wrap:break-word;"><th class="cl-5972223c"><p class="cl-5971fffa"><span class="cl-596d9ba4">.</span></p></th></tr></thead><tbody><tr style="overflow-wrap:break-word;"><td class="cl-59722250"><p class="cl-5971fffa"><span class="cl-596d9bc2">THE ORIGIN OF SPECIES BY CHARLES DARWIN AN HISTORICAL SKETCH OF THE PROGRESS OF OPINION ON THE ORIGIN OF SPECIES INTRODUCTION When on board H.M.S. 'Beagle,' as naturalist, I was much struck with certa</span></p></td></tr></tbody></table></div>
</div>
<div id="identifying-n-grams" class="section level1" number="4">
<h1><span class="header-section-number">4</span> Identifying
N-grams</h1>
<p>We could create bi-grams (N-grams consisting of two elements) by
manually pasting every word together with the word that immediately
follows but we use the <code>quanteda</code> package <span
class="citation">(see <a href="#ref-quanteda">Benoit et al.
2018</a>)</span> which offers excellent and very fast functions for
extracting bigrams.</p>
<pre class="r"><code>#clean corpus
darwin_clean &lt;- darwin %&gt;%
  stringr::str_to_title()
# tokenize corpus
darwin_tokzd &lt;- quanteda::tokens(darwin_clean)
# extract bigrams
BiGrams &lt;- darwin_tokzd %&gt;% 
       quanteda::tokens_remove(stopwords(&quot;en&quot;)) %&gt;% 
       quanteda::tokens_select(pattern = &quot;^[A-Z]&quot;, 
                               valuetype = &quot;regex&quot;,
                               case_insensitive = FALSE, 
                               padding = TRUE) %&gt;% 
       quanteda.textstats::textstat_collocations(min_count = 5, tolower = FALSE)</code></pre>
<div class="tabwid"><style>.cl-5c871036{table-layout:auto;width:50%;}.cl-5c7983a8{font-family:'Arial';font-size:12pt;font-weight:bold;font-style:normal;text-decoration:none;color:rgba(0, 0, 0, 1.00);background-color:transparent;}.cl-5c7983bc{font-family:'Arial';font-size:12pt;font-weight:normal;font-style:normal;text-decoration:none;color:rgba(0, 0, 0, 1.00);background-color:transparent;}.cl-5c7d7b84{margin:0;text-align:center;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);padding-bottom:5pt;padding-top:5pt;padding-left:5pt;padding-right:5pt;line-height: 1;background-color:transparent;}.cl-5c7d7b98{margin:0;text-align:right;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);padding-bottom:5pt;padding-top:5pt;padding-left:5pt;padding-right:5pt;line-height: 1;background-color:transparent;}.cl-5c7da69a{background-color:rgba(207, 207, 207, 1.00);vertical-align: middle;border-bottom: 1pt solid rgba(102, 102, 102, 1.00);border-top: 1pt solid rgba(102, 102, 102, 1.00);border-left: 1pt solid rgba(102, 102, 102, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-5c7da6ae{background-color:rgba(207, 207, 207, 1.00);vertical-align: middle;border-bottom: 1pt solid rgba(102, 102, 102, 1.00);border-top: 1pt solid rgba(102, 102, 102, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-5c7da6b8{background-color:rgba(207, 207, 207, 1.00);vertical-align: middle;border-bottom: 1pt solid rgba(102, 102, 102, 1.00);border-top: 1pt solid rgba(102, 102, 102, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 1pt solid rgba(102, 102, 102, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-5c7da6b9{background-color:rgba(239, 239, 239, 1.00);vertical-align: middle;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 1pt solid rgba(102, 102, 102, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-5c7da6c2{background-color:rgba(239, 239, 239, 1.00);vertical-align: middle;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-5c7da6c3{background-color:rgba(239, 239, 239, 1.00);vertical-align: middle;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 1pt solid rgba(102, 102, 102, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-5c7da6cc{background-color:transparent;vertical-align: middle;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 1pt solid rgba(102, 102, 102, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-5c7da6cd{background-color:transparent;vertical-align: middle;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-5c7da6d6{background-color:transparent;vertical-align: middle;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 1pt solid rgba(102, 102, 102, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-5c7da6d7{background-color:rgba(239, 239, 239, 1.00);vertical-align: middle;border-bottom: 1pt solid rgba(102, 102, 102, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 1pt solid rgba(102, 102, 102, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-5c7da6e0{background-color:rgba(239, 239, 239, 1.00);vertical-align: middle;border-bottom: 1pt solid rgba(102, 102, 102, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-5c7da6e1{background-color:rgba(239, 239, 239, 1.00);vertical-align: middle;border-bottom: 1pt solid rgba(102, 102, 102, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 1pt solid rgba(102, 102, 102, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}</style><table data-quarto-disable-processing='true' class='cl-5c871036'><caption style="display:table-caption;margin:0pt;text-align:center;border-bottom: 0.00pt solid transparent;border-top: 0.00pt solid transparent;border-left: 0.00pt solid transparent;border-right: 0.00pt solid transparent;padding-top:3pt;padding-bottom:3pt;padding-left:3pt;padding-right:3pt;line-height: 1;background-color:transparent;"><span></span></caption><thead><tr style="overflow-wrap:break-word;"><th class="cl-5c7da69a"><p class="cl-5c7d7b84"><span class="cl-5c7983a8">collocation</span></p></th><th class="cl-5c7da6ae"><p class="cl-5c7d7b98"><span class="cl-5c7983a8">count</span></p></th><th class="cl-5c7da6ae"><p class="cl-5c7d7b98"><span class="cl-5c7983a8">count_nested</span></p></th><th class="cl-5c7da6ae"><p class="cl-5c7d7b98"><span class="cl-5c7983a8">length</span></p></th><th class="cl-5c7da6ae"><p class="cl-5c7d7b98"><span class="cl-5c7983a8">lambda</span></p></th><th class="cl-5c7da6b8"><p class="cl-5c7d7b98"><span class="cl-5c7983a8">z</span></p></th></tr></thead><tbody><tr style="overflow-wrap:break-word;"><td class="cl-5c7da6b9"><p class="cl-5c7d7b84"><span class="cl-5c7983bc">Natural Selection</span></p></td><td class="cl-5c7da6c2"><p class="cl-5c7d7b98"><span class="cl-5c7983bc">405</span></p></td><td class="cl-5c7da6c2"><p class="cl-5c7d7b98"><span class="cl-5c7983bc">0</span></p></td><td class="cl-5c7da6c2"><p class="cl-5c7d7b98"><span class="cl-5c7983bc">2</span></p></td><td class="cl-5c7da6c2"><p class="cl-5c7d7b98"><span class="cl-5c7983bc">8.042805</span></p></td><td class="cl-5c7da6c3"><p class="cl-5c7d7b98"><span class="cl-5c7983bc">59.11191</span></p></td></tr><tr style="overflow-wrap:break-word;"><td class="cl-5c7da6cc"><p class="cl-5c7d7b84"><span class="cl-5c7983bc">Conditions Life</span></p></td><td class="cl-5c7da6cd"><p class="cl-5c7d7b98"><span class="cl-5c7983bc">119</span></p></td><td class="cl-5c7da6cd"><p class="cl-5c7d7b98"><span class="cl-5c7983bc">0</span></p></td><td class="cl-5c7da6cd"><p class="cl-5c7d7b98"><span class="cl-5c7983bc">2</span></p></td><td class="cl-5c7da6cd"><p class="cl-5c7d7b98"><span class="cl-5c7983bc">5.941652</span></p></td><td class="cl-5c7da6d6"><p class="cl-5c7d7b98"><span class="cl-5c7983bc">43.44166</span></p></td></tr><tr style="overflow-wrap:break-word;"><td class="cl-5c7da6b9"><p class="cl-5c7d7b84"><span class="cl-5c7983bc">Organic Beings</span></p></td><td class="cl-5c7da6c2"><p class="cl-5c7d7b98"><span class="cl-5c7983bc">107</span></p></td><td class="cl-5c7da6c2"><p class="cl-5c7d7b98"><span class="cl-5c7983bc">0</span></p></td><td class="cl-5c7da6c2"><p class="cl-5c7d7b98"><span class="cl-5c7983bc">2</span></p></td><td class="cl-5c7da6c2"><p class="cl-5c7d7b98"><span class="cl-5c7983bc">8.495650</span></p></td><td class="cl-5c7da6c3"><p class="cl-5c7d7b98"><span class="cl-5c7983bc">38.54131</span></p></td></tr><tr style="overflow-wrap:break-word;"><td class="cl-5c7da6cc"><p class="cl-5c7d7b84"><span class="cl-5c7983bc">Closely Allied</span></p></td><td class="cl-5c7da6cd"><p class="cl-5c7d7b98"><span class="cl-5c7983bc">64</span></p></td><td class="cl-5c7da6cd"><p class="cl-5c7d7b98"><span class="cl-5c7983bc">0</span></p></td><td class="cl-5c7da6cd"><p class="cl-5c7d7b98"><span class="cl-5c7983bc">2</span></p></td><td class="cl-5c7da6cd"><p class="cl-5c7d7b98"><span class="cl-5c7983bc">6.796840</span></p></td><td class="cl-5c7da6d6"><p class="cl-5c7d7b98"><span class="cl-5c7983bc">35.14814</span></p></td></tr><tr style="overflow-wrap:break-word;"><td class="cl-5c7da6b9"><p class="cl-5c7d7b84"><span class="cl-5c7983bc">South America</span></p></td><td class="cl-5c7da6c2"><p class="cl-5c7d7b98"><span class="cl-5c7983bc">44</span></p></td><td class="cl-5c7da6c2"><p class="cl-5c7d7b98"><span class="cl-5c7983bc">0</span></p></td><td class="cl-5c7da6c2"><p class="cl-5c7d7b98"><span class="cl-5c7983bc">2</span></p></td><td class="cl-5c7da6c2"><p class="cl-5c7d7b98"><span class="cl-5c7983bc">7.632834</span></p></td><td class="cl-5c7da6c3"><p class="cl-5c7d7b98"><span class="cl-5c7983bc">30.34521</span></p></td></tr><tr style="overflow-wrap:break-word;"><td class="cl-5c7da6cc"><p class="cl-5c7d7b84"><span class="cl-5c7983bc">Widely Different</span></p></td><td class="cl-5c7da6cd"><p class="cl-5c7d7b98"><span class="cl-5c7983bc">51</span></p></td><td class="cl-5c7da6cd"><p class="cl-5c7d7b98"><span class="cl-5c7983bc">0</span></p></td><td class="cl-5c7da6cd"><p class="cl-5c7d7b98"><span class="cl-5c7983bc">2</span></p></td><td class="cl-5c7da6cd"><p class="cl-5c7d7b98"><span class="cl-5c7983bc">5.472341</span></p></td><td class="cl-5c7da6d6"><p class="cl-5c7d7b98"><span class="cl-5c7983bc">29.73497</span></p></td></tr><tr style="overflow-wrap:break-word;"><td class="cl-5c7da6b9"><p class="cl-5c7d7b84"><span class="cl-5c7983bc">Modified Descendants</span></p></td><td class="cl-5c7da6c2"><p class="cl-5c7d7b98"><span class="cl-5c7983bc">41</span></p></td><td class="cl-5c7da6c2"><p class="cl-5c7d7b98"><span class="cl-5c7983bc">0</span></p></td><td class="cl-5c7da6c2"><p class="cl-5c7d7b98"><span class="cl-5c7983bc">2</span></p></td><td class="cl-5c7da6c2"><p class="cl-5c7d7b98"><span class="cl-5c7983bc">6.107300</span></p></td><td class="cl-5c7da6c3"><p class="cl-5c7d7b98"><span class="cl-5c7983bc">28.83592</span></p></td></tr><tr style="overflow-wrap:break-word;"><td class="cl-5c7da6cc"><p class="cl-5c7d7b84"><span class="cl-5c7983bc">Distinct Species</span></p></td><td class="cl-5c7da6cd"><p class="cl-5c7d7b98"><span class="cl-5c7983bc">105</span></p></td><td class="cl-5c7da6cd"><p class="cl-5c7d7b98"><span class="cl-5c7983bc">0</span></p></td><td class="cl-5c7da6cd"><p class="cl-5c7d7b98"><span class="cl-5c7983bc">2</span></p></td><td class="cl-5c7da6cd"><p class="cl-5c7d7b98"><span class="cl-5c7983bc">3.446173</span></p></td><td class="cl-5c7da6d6"><p class="cl-5c7d7b98"><span class="cl-5c7983bc">28.82572</span></p></td></tr><tr style="overflow-wrap:break-word;"><td class="cl-5c7da6b9"><p class="cl-5c7d7b84"><span class="cl-5c7983bc">State Nature</span></p></td><td class="cl-5c7da6c2"><p class="cl-5c7d7b98"><span class="cl-5c7983bc">45</span></p></td><td class="cl-5c7da6c2"><p class="cl-5c7d7b98"><span class="cl-5c7983bc">0</span></p></td><td class="cl-5c7da6c2"><p class="cl-5c7d7b98"><span class="cl-5c7983bc">2</span></p></td><td class="cl-5c7da6c2"><p class="cl-5c7d7b98"><span class="cl-5c7983bc">5.390191</span></p></td><td class="cl-5c7da6c3"><p class="cl-5c7d7b98"><span class="cl-5c7983bc">28.29833</span></p></td></tr><tr style="overflow-wrap:break-word;"><td class="cl-5c7da6cc"><p class="cl-5c7d7b84"><span class="cl-5c7983bc">Theory Natural</span></p></td><td class="cl-5c7da6cd"><p class="cl-5c7d7b98"><span class="cl-5c7983bc">52</span></p></td><td class="cl-5c7da6cd"><p class="cl-5c7d7b98"><span class="cl-5c7983bc">0</span></p></td><td class="cl-5c7da6cd"><p class="cl-5c7d7b98"><span class="cl-5c7983bc">2</span></p></td><td class="cl-5c7da6cd"><p class="cl-5c7d7b98"><span class="cl-5c7983bc">4.820678</span></p></td><td class="cl-5c7da6d6"><p class="cl-5c7d7b98"><span class="cl-5c7983bc">27.64530</span></p></td></tr><tr style="overflow-wrap:break-word;"><td class="cl-5c7da6b9"><p class="cl-5c7d7b84"><span class="cl-5c7983bc">Individual Differences</span></p></td><td class="cl-5c7da6c2"><p class="cl-5c7d7b98"><span class="cl-5c7983bc">35</span></p></td><td class="cl-5c7da6c2"><p class="cl-5c7d7b98"><span class="cl-5c7983bc">0</span></p></td><td class="cl-5c7da6c2"><p class="cl-5c7d7b98"><span class="cl-5c7983bc">2</span></p></td><td class="cl-5c7da6c2"><p class="cl-5c7d7b98"><span class="cl-5c7983bc">6.090231</span></p></td><td class="cl-5c7da6c3"><p class="cl-5c7d7b98"><span class="cl-5c7983bc">27.36156</span></p></td></tr><tr style="overflow-wrap:break-word;"><td class="cl-5c7da6cc"><p class="cl-5c7d7b84"><span class="cl-5c7983bc">North America</span></p></td><td class="cl-5c7da6cd"><p class="cl-5c7d7b98"><span class="cl-5c7983bc">31</span></p></td><td class="cl-5c7da6cd"><p class="cl-5c7d7b98"><span class="cl-5c7983bc">0</span></p></td><td class="cl-5c7da6cd"><p class="cl-5c7d7b98"><span class="cl-5c7983bc">2</span></p></td><td class="cl-5c7da6cd"><p class="cl-5c7d7b98"><span class="cl-5c7983bc">7.164566</span></p></td><td class="cl-5c7da6d6"><p class="cl-5c7d7b98"><span class="cl-5c7983bc">26.78011</span></p></td></tr><tr style="overflow-wrap:break-word;"><td class="cl-5c7da6b9"><p class="cl-5c7d7b84"><span class="cl-5c7983bc">Reason Believe</span></p></td><td class="cl-5c7da6c2"><p class="cl-5c7d7b98"><span class="cl-5c7983bc">34</span></p></td><td class="cl-5c7da6c2"><p class="cl-5c7d7b98"><span class="cl-5c7983bc">0</span></p></td><td class="cl-5c7da6c2"><p class="cl-5c7d7b98"><span class="cl-5c7983bc">2</span></p></td><td class="cl-5c7da6c2"><p class="cl-5c7d7b98"><span class="cl-5c7983bc">6.407163</span></p></td><td class="cl-5c7da6c3"><p class="cl-5c7d7b98"><span class="cl-5c7983bc">26.77125</span></p></td></tr><tr style="overflow-wrap:break-word;"><td class="cl-5c7da6cc"><p class="cl-5c7d7b84"><span class="cl-5c7983bc">Forms Life</span></p></td><td class="cl-5c7da6cd"><p class="cl-5c7d7b98"><span class="cl-5c7983bc">57</span></p></td><td class="cl-5c7da6cd"><p class="cl-5c7d7b98"><span class="cl-5c7983bc">0</span></p></td><td class="cl-5c7da6cd"><p class="cl-5c7d7b98"><span class="cl-5c7983bc">2</span></p></td><td class="cl-5c7da6cd"><p class="cl-5c7d7b98"><span class="cl-5c7983bc">3.987827</span></p></td><td class="cl-5c7da6d6"><p class="cl-5c7d7b98"><span class="cl-5c7983bc">26.18419</span></p></td></tr><tr style="overflow-wrap:break-word;"><td class="cl-5c7da6d7"><p class="cl-5c7d7b84"><span class="cl-5c7983bc">Throughout World</span></p></td><td class="cl-5c7da6e0"><p class="cl-5c7d7b98"><span class="cl-5c7983bc">30</span></p></td><td class="cl-5c7da6e0"><p class="cl-5c7d7b98"><span class="cl-5c7983bc">0</span></p></td><td class="cl-5c7da6e0"><p class="cl-5c7d7b98"><span class="cl-5c7983bc">2</span></p></td><td class="cl-5c7da6e0"><p class="cl-5c7d7b98"><span class="cl-5c7983bc">6.417986</span></p></td><td class="cl-5c7da6e1"><p class="cl-5c7d7b98"><span class="cl-5c7983bc">26.02915</span></p></td></tr></tbody></table></div>
<p>We can also extract bigrams very easily using the
<code>tokens_compound</code> function which understands that we are
looking for two-word expressions.</p>
<pre class="r"><code>ngram_extract &lt;- quanteda::tokens_compound(darwin_tokzd, pattern = BiGrams)</code></pre>
<p>We can now generate concordances (and clean the resulting kwic table
- the keyword-in-context table).</p>
<pre class="r"><code>ngram_kwic &lt;- kwic(ngram_extract, pattern = c(&quot;Natural_Selection&quot;, &quot;South_America&quot;)) %&gt;%
  as.data.frame() %&gt;%
  dplyr::select(-to, -from, -pattern)</code></pre>
<div class="tabwid"><style>.cl-5f2bb6d4{table-layout:auto;width:95%;}.cl-5f20fd84{font-family:'Arial';font-size:12pt;font-weight:bold;font-style:normal;text-decoration:none;color:rgba(0, 0, 0, 1.00);background-color:transparent;}.cl-5f20fd8e{font-family:'Arial';font-size:12pt;font-weight:normal;font-style:normal;text-decoration:none;color:rgba(0, 0, 0, 1.00);background-color:transparent;}.cl-5f24dfa8{margin:0;text-align:center;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);padding-bottom:5pt;padding-top:5pt;padding-left:5pt;padding-right:5pt;line-height: 1;background-color:transparent;}.cl-5f24fbf0{background-color:rgba(207, 207, 207, 1.00);vertical-align: middle;border-bottom: 1pt solid rgba(102, 102, 102, 1.00);border-top: 1pt solid rgba(102, 102, 102, 1.00);border-left: 1pt solid rgba(102, 102, 102, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-5f24fbfa{background-color:rgba(207, 207, 207, 1.00);vertical-align: middle;border-bottom: 1pt solid rgba(102, 102, 102, 1.00);border-top: 1pt solid rgba(102, 102, 102, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-5f24fc04{background-color:rgba(207, 207, 207, 1.00);vertical-align: middle;border-bottom: 1pt solid rgba(102, 102, 102, 1.00);border-top: 1pt solid rgba(102, 102, 102, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 1pt solid rgba(102, 102, 102, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-5f24fc0e{background-color:rgba(239, 239, 239, 1.00);vertical-align: middle;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 1pt solid rgba(102, 102, 102, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-5f24fc0f{background-color:rgba(239, 239, 239, 1.00);vertical-align: middle;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-5f24fc10{background-color:rgba(239, 239, 239, 1.00);vertical-align: middle;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 1pt solid rgba(102, 102, 102, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-5f24fc18{background-color:transparent;vertical-align: middle;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 1pt solid rgba(102, 102, 102, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-5f24fc19{background-color:transparent;vertical-align: middle;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-5f24fc22{background-color:transparent;vertical-align: middle;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 1pt solid rgba(102, 102, 102, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-5f24fc23{background-color:rgba(239, 239, 239, 1.00);vertical-align: middle;border-bottom: 1pt solid rgba(102, 102, 102, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 1pt solid rgba(102, 102, 102, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-5f24fc2c{background-color:rgba(239, 239, 239, 1.00);vertical-align: middle;border-bottom: 1pt solid rgba(102, 102, 102, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-5f24fc2d{background-color:rgba(239, 239, 239, 1.00);vertical-align: middle;border-bottom: 1pt solid rgba(102, 102, 102, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 1pt solid rgba(102, 102, 102, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}</style><table data-quarto-disable-processing='true' class='cl-5f2bb6d4'><caption style="display:table-caption;margin:0pt;text-align:center;border-bottom: 0.00pt solid transparent;border-top: 0.00pt solid transparent;border-left: 0.00pt solid transparent;border-right: 0.00pt solid transparent;padding-top:3pt;padding-bottom:3pt;padding-left:3pt;padding-right:3pt;line-height: 1;background-color:transparent;"><span></span></caption><thead><tr style="overflow-wrap:break-word;"><th class="cl-5f24fbf0"><p class="cl-5f24dfa8"><span class="cl-5f20fd84">docname</span></p></th><th class="cl-5f24fbfa"><p class="cl-5f24dfa8"><span class="cl-5f20fd84">pre</span></p></th><th class="cl-5f24fbfa"><p class="cl-5f24dfa8"><span class="cl-5f20fd84">keyword</span></p></th><th class="cl-5f24fc04"><p class="cl-5f24dfa8"><span class="cl-5f20fd84">post</span></p></th></tr></thead><tbody><tr style="overflow-wrap:break-word;"><td class="cl-5f24fc0e"><p class="cl-5f24dfa8"><span class="cl-5f20fd8e">text1</span></p></td><td class="cl-5f24fc0f"><p class="cl-5f24dfa8"><span class="cl-5f20fd8e">Distribution Of The Organic_Beings Inhabiting</span></p></td><td class="cl-5f24fc0f"><p class="cl-5f24dfa8"><span class="cl-5f20fd8e">South_America</span></p></td><td class="cl-5f24fc10"><p class="cl-5f24dfa8"><span class="cl-5f20fd8e">, And In The Geological</span></p></td></tr><tr style="overflow-wrap:break-word;"><td class="cl-5f24fc18"><p class="cl-5f24dfa8"><span class="cl-5f20fd8e">text1</span></p></td><td class="cl-5f24fc19"><p class="cl-5f24dfa8"><span class="cl-5f20fd8e">We Shall Then See How</span></p></td><td class="cl-5f24fc19"><p class="cl-5f24dfa8"><span class="cl-5f20fd8e">Natural_Selection</span></p></td><td class="cl-5f24fc22"><p class="cl-5f24dfa8"><span class="cl-5f20fd8e">Almost_Inevitably Causes Much_Extinction Of The</span></p></td></tr><tr style="overflow-wrap:break-word;"><td class="cl-5f24fc0e"><p class="cl-5f24dfa8"><span class="cl-5f20fd8e">text1</span></p></td><td class="cl-5f24fc0f"><p class="cl-5f24dfa8"><span class="cl-5f20fd8e">, I Am Convinced That</span></p></td><td class="cl-5f24fc0f"><p class="cl-5f24dfa8"><span class="cl-5f20fd8e">Natural_Selection</span></p></td><td class="cl-5f24fc10"><p class="cl-5f24dfa8"><span class="cl-5f20fd8e">Has Been The Most Important</span></p></td></tr><tr style="overflow-wrap:break-word;"><td class="cl-5f24fc18"><p class="cl-5f24dfa8"><span class="cl-5f20fd8e">text1</span></p></td><td class="cl-5f24fc19"><p class="cl-5f24dfa8"><span class="cl-5f20fd8e">By A Process Of "</span></p></td><td class="cl-5f24fc19"><p class="cl-5f24dfa8"><span class="cl-5f20fd8e">Natural_Selection</span></p></td><td class="cl-5f24fc22"><p class="cl-5f24dfa8"><span class="cl-5f20fd8e">, " As Will Hereafter</span></p></td></tr><tr style="overflow-wrap:break-word;"><td class="cl-5f24fc0e"><p class="cl-5f24dfa8"><span class="cl-5f20fd8e">text1</span></p></td><td class="cl-5f24fc0f"><p class="cl-5f24dfa8"><span class="cl-5f20fd8e">They Thus Aft'ord Materials For</span></p></td><td class="cl-5f24fc0f"><p class="cl-5f24dfa8"><span class="cl-5f20fd8e">Natural_Selection</span></p></td><td class="cl-5f24fc10"><p class="cl-5f24dfa8"><span class="cl-5f20fd8e">To Act On And Accumulate</span></p></td></tr><tr style="overflow-wrap:break-word;"><td class="cl-5f24fc18"><p class="cl-5f24dfa8"><span class="cl-5f20fd8e">text1</span></p></td><td class="cl-5f24fc19"><p class="cl-5f24dfa8"><span class="cl-5f20fd8e">On And Rendered Definite By</span></p></td><td class="cl-5f24fc19"><p class="cl-5f24dfa8"><span class="cl-5f20fd8e">Natural_Selection</span></p></td><td class="cl-5f24fc22"><p class="cl-5f24dfa8"><span class="cl-5f20fd8e">, As Hereafter To Be</span></p></td></tr><tr style="overflow-wrap:break-word;"><td class="cl-5f24fc0e"><p class="cl-5f24dfa8"><span class="cl-5f20fd8e">text1</span></p></td><td class="cl-5f24fc0f"><p class="cl-5f24dfa8"><span class="cl-5f20fd8e">To The Cumulative Action Of</span></p></td><td class="cl-5f24fc0f"><p class="cl-5f24dfa8"><span class="cl-5f20fd8e">Natural_Selection</span></p></td><td class="cl-5f24fc10"><p class="cl-5f24dfa8"><span class="cl-5f20fd8e">, Hereafter To Be Explained</span></p></td></tr><tr style="overflow-wrap:break-word;"><td class="cl-5f24fc18"><p class="cl-5f24dfa8"><span class="cl-5f20fd8e">text1</span></p></td><td class="cl-5f24fc19"><p class="cl-5f24dfa8"><span class="cl-5f20fd8e">For Existence Its Bearing On</span></p></td><td class="cl-5f24fc19"><p class="cl-5f24dfa8"><span class="cl-5f20fd8e">Natural_Selection</span></p></td><td class="cl-5f24fc22"><p class="cl-5f24dfa8"><span class="cl-5f20fd8e">— The Term Used In</span></p></td></tr><tr style="overflow-wrap:break-word;"><td class="cl-5f24fc0e"><p class="cl-5f24dfa8"><span class="cl-5f20fd8e">text1</span></p></td><td class="cl-5f24fc0f"><p class="cl-5f24dfa8"><span class="cl-5f20fd8e">Struggle For Existence Bears On</span></p></td><td class="cl-5f24fc0f"><p class="cl-5f24dfa8"><span class="cl-5f20fd8e">Natural_Selection</span></p></td><td class="cl-5f24fc10"><p class="cl-5f24dfa8"><span class="cl-5f20fd8e">. It Has Been Seen</span></p></td></tr><tr style="overflow-wrap:break-word;"><td class="cl-5f24fc18"><p class="cl-5f24dfa8"><span class="cl-5f20fd8e">text1</span></p></td><td class="cl-5f24fc19"><p class="cl-5f24dfa8"><span class="cl-5f20fd8e">Preserved , By The Term</span></p></td><td class="cl-5f24fc19"><p class="cl-5f24dfa8"><span class="cl-5f20fd8e">Natural_Selection</span></p></td><td class="cl-5f24fc22"><p class="cl-5f24dfa8"><span class="cl-5f20fd8e">, In Order To Mark</span></p></td></tr><tr style="overflow-wrap:break-word;"><td class="cl-5f24fc0e"><p class="cl-5f24dfa8"><span class="cl-5f20fd8e">text1</span></p></td><td class="cl-5f24fc0f"><p class="cl-5f24dfa8"><span class="cl-5f20fd8e">Hand Of Nature . But</span></p></td><td class="cl-5f24fc0f"><p class="cl-5f24dfa8"><span class="cl-5f20fd8e">Natural_Selection</span></p></td><td class="cl-5f24fc10"><p class="cl-5f24dfa8"><span class="cl-5f20fd8e">, As We Shall_Hereafter_See ,</span></p></td></tr><tr style="overflow-wrap:break-word;"><td class="cl-5f24fc18"><p class="cl-5f24dfa8"><span class="cl-5f20fd8e">text1</span></p></td><td class="cl-5f24fc19"><p class="cl-5f24dfa8"><span class="cl-5f20fd8e">Slow-Breeding Cattle And Horses In</span></p></td><td class="cl-5f24fc19"><p class="cl-5f24dfa8"><span class="cl-5f20fd8e">South_America</span></p></td><td class="cl-5f24fc22"><p class="cl-5f24dfa8"><span class="cl-5f20fd8e">, And Latterly In Australia</span></p></td></tr><tr style="overflow-wrap:break-word;"><td class="cl-5f24fc0e"><p class="cl-5f24dfa8"><span class="cl-5f20fd8e">text1</span></p></td><td class="cl-5f24fc0f"><p class="cl-5f24dfa8"><span class="cl-5f20fd8e">To The Feral Animals Of</span></p></td><td class="cl-5f24fc0f"><p class="cl-5f24dfa8"><span class="cl-5f20fd8e">South_America</span></p></td><td class="cl-5f24fc10"><p class="cl-5f24dfa8"><span class="cl-5f20fd8e">. Here I Will Make</span></p></td></tr><tr style="overflow-wrap:break-word;"><td class="cl-5f24fc18"><p class="cl-5f24dfa8"><span class="cl-5f20fd8e">text1</span></p></td><td class="cl-5f24fc19"><p class="cl-5f24dfa8"><span class="cl-5f20fd8e">Have Observeu In Parts Of</span></p></td><td class="cl-5f24fc19"><p class="cl-5f24dfa8"><span class="cl-5f20fd8e">South_America</span></p></td><td class="cl-5f24fc22"><p class="cl-5f24dfa8"><span class="cl-5f20fd8e">) The Vegetation : This</span></p></td></tr><tr style="overflow-wrap:break-word;"><td class="cl-5f24fc23"><p class="cl-5f24dfa8"><span class="cl-5f20fd8e">text1</span></p></td><td class="cl-5f24fc2c"><p class="cl-5f24dfa8"><span class="cl-5f20fd8e">And Multiply . Chapter Iv</span></p></td><td class="cl-5f24fc2c"><p class="cl-5f24dfa8"><span class="cl-5f20fd8e">Natural_Selection</span></p></td><td class="cl-5f24fc2d"><p class="cl-5f24dfa8"><span class="cl-5f20fd8e">; Or The Survival Of</span></p></td></tr></tbody></table></div>
<p>The disadvantage here is that we are strictly speaking only
extracting N-Grams but not collocates as collocates do not necessarily
have to occur in direct adjacency. The following section shows how to
expand the extraction of n-grams to the extraction of collocates.</p>
</div>
<div id="identifying-collocations" class="section level1" number="5">
<h1><span class="header-section-number">5</span> Identifying
Collocations</h1>
<p>Both N-grams and collocations are not only an important concept in
language teaching but they are also fundamental in Text Analysis and
many other research areas working with language data. Unfortunately,
words that collocate do not have to be immediately adjacent but can also
encompass several slots. This is unfortunate because it makes retrieval
of collocates substantially more difficult compared with a situation in
which we only need to extract words that occur right next to each
other.</p>
<p>In the following, we will extract collocations from Charles Darwin’s
<em>On the Origin of Species by Means of Natural Selection</em>. In a
first step, we will split the Origin into individual sentences.</p>
<pre class="r"><code># read in and process text
darwinsentences &lt;- darwin %&gt;%
  stringr::str_squish() %&gt;%
  tokenizers::tokenize_sentences(.) %&gt;%
  unlist() %&gt;%
  stringr::str_remove_all(&quot;- &quot;) %&gt;%
  stringr::str_replace_all(&quot;\\W&quot;, &quot; &quot;) %&gt;%
  stringr::str_squish()
# inspect data
head(darwinsentences)</code></pre>
<pre><code>## [1] &quot;THE ORIGIN OF SPECIES BY CHARLES DARWIN AN HISTORICAL SKETCH OF THE PROGRESS OF OPINION ON THE ORIGIN OF SPECIES INTRODUCTION When on board H M S&quot;                                                                                                                     
## [2] &quot;Beagle as naturalist I was much struck with certain facts in the distribution of the organic beings inhabiting South America and in the geological relations of the present to the past inhabitants of that continent&quot;                                                 
## [3] &quot;These facts as will be seen in the latter chapters of this volume seemed to throw some light on the origin of species that mystery of mysteries as it has been called by one of our greatest philosophers&quot;                                                             
## [4] &quot;On my return home it occurred to me in 1837 that something might perhaps be made out on this question by patiently accumulating and reflecting on all sorts of facts which could possibly have any bearing on it&quot;                                                      
## [5] &quot;After five years work I allowed myself to speculate on the subject and drew up some short notes these I enlarged in 1844 into a sketch of the conclusions which then seemed to me probable from that period to the present day I have steadily pursued the same object&quot;
## [6] &quot;I hope that I may be excused for entering on these personal details as I give them to show that I have not been hasty in coming to a decision&quot;</code></pre>
<p>The first element does not represent a full sentence because we
selected a sample of the text which began in the middle of a sentence
rather than at its beginning. In a next step, we can tokenize these
sentences and apply the <code>textstat_collocations</code> function
which identifies collocations.</p>
<pre class="r"><code># create a token object
text_tokens &lt;- tokens(darwinsentences, remove_punct = TRUE) %&gt;%
  tokens_remove(stopwords(&quot;english&quot;))
# extract collocations
text_coll &lt;- textstat_collocations(text_tokens, size = 2, min_count = 20)
# inspect
text_coll[1:6, 1:6]</code></pre>
<pre><code>##         collocation count count_nested length   lambda        z
## 1 natural selection   369            0      2 7.761937 55.74437
## 2   conditions life   119            0      2 5.871014 41.63180
## 3    organic beings    99            0      2 8.151779 36.69899
## 4    closely allied    73            0      2 6.705593 35.27159
## 5     south america    44            0      2 7.475924 29.32621
## 6  widely different    53            0      2 5.250150 28.86132</code></pre>
<p>The resulting table shows collocations in the example text descending
by collocation strength.</p>
<div id="visualizing-collocation-networks" class="section level2"
number="5.1">
<h2><span class="header-section-number">5.1</span> Visualizing
Collocation Networks</h2>
<p>Network graphs are a very useful and flexible tool for visualizing
relationships between elements such as words, personas, or authors. This
section shows how to generate a network graph for collocations of the
term alice using the quanteda package.</p>
<p>In a first step, we generate a document-feature matrix based on the
sentences in the example text. A document-feature matrix shows how often
elements (here these elements are the words that occur in the the
example text) occur in a selection of documents (here these documents
are the sentences in the example text).</p>
<pre class="r"><code>text_dfm &lt;- darwinsentences %&gt;% 
  quanteda::tokens(remove_punct = TRUE)  %&gt;%
  dfm() %&gt;%
  quanteda::dfm_remove(stopwords(&#39;english&#39;)) %&gt;%
  quanteda::dfm_remove(c(&quot;will&quot;, &quot;h&quot;, &quot;m&quot;)) %&gt;%
  quanteda::dfm_trim(min_termfreq = 10, verbose = FALSE)
# inspect
text_dfm[1:6, 1:6]</code></pre>
<pre><code>## Document-feature matrix of: 6 documents, 6 features (77.78% sparse) and 0 docvars.
##        features
## docs    origin species charles progress opinion s
##   text1      2       2       1        1       1 1
##   text2      0       0       0        0       0 0
##   text3      1       1       0        0       0 0
##   text4      0       0       0        0       0 0
##   text5      0       0       0        0       0 0
##   text6      0       0       0        0       0 0</code></pre>
</div>
</div>
<div id="create-document-feature-matrix" class="section level1"
number="6">
<h1><span class="header-section-number">6</span> Create document-feature
matrix</h1>
<p>As we want to generate a network graph of words that collocate with
the term organism, we use the <code>calculateCoocStatistics</code>
function to determine which words most strongly collocate with our
target term (organism).</p>
<pre class="r"><code># load function for co-occurrence calculation
source(&quot;https://slcladal.github.io/rscripts/calculateCoocStatistics.R&quot;)
# define term
coocTerm &lt;- &quot;selection&quot;
# calculate co-occurrence statistics
coocs &lt;- calculateCoocStatistics(coocTerm, text_dfm, measure=&quot;LOGLIK&quot;)</code></pre>
<pre><code>## Loading required package: slam</code></pre>
<pre class="r"><code># inspect results
coocs[1:20]</code></pre>
<pre><code>##       natural        theory    variations       effects modifications 
##    1766.44751     127.86330     124.94947      69.94048      63.52192 
##          acts         power        slight     advantage        disuse 
##      53.15165      53.14602      48.94158      48.21207      47.84167 
##   accumulated        sexual     variation     principle        useful 
##      46.99429      44.31103      43.64372      42.17271      39.36931 
##  preservation      survival     structure        action    favourable 
##      37.35337      36.59873      36.37859      35.18738      35.06886</code></pre>
<p>The output shows that the word most strongly associated with
<em>selection</em> in Charles Darwin’s <em>Origin</em> is unsurprisingly
<em>natural</em> - given the substantive strength of the association
between <em>natural</em> and <em>selection</em> these term are
definitely collocates and almost - if not already - a lexicalized
construction (at least in this text).</p>
<p>There are various visualizations options for collocations. Which
visualization method is appropriate depends on what the visualizations
should display.</p>
<div id="association-strength" class="section level2 unnumbered">
<h2 class="unnumbered">Association Strength</h2>
<p>We start with the most basic and visualize the collocation strength
using a simple dot chart. We use the vector of association strengths
generated above and transform it into a table. Also, we exclude elements
with an association strength lower than 30.</p>
<pre class="r"><code>coocdf &lt;- coocs %&gt;%
  as.data.frame() %&gt;%
  dplyr::mutate(CollStrength = coocs,
                Term = names(coocs)) %&gt;%
  dplyr::filter(CollStrength &gt; 30)</code></pre>
<div class="tabwid"><style>.cl-60185912{table-layout:auto;width:50%;}.cl-600d7376{font-family:'Arial';font-size:12pt;font-weight:bold;font-style:normal;text-decoration:none;color:rgba(0, 0, 0, 1.00);background-color:transparent;}.cl-600d7380{font-family:'Arial';font-size:12pt;font-weight:normal;font-style:normal;text-decoration:none;color:rgba(0, 0, 0, 1.00);background-color:transparent;}.cl-60115cc0{margin:0;text-align:center;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);padding-bottom:5pt;padding-top:5pt;padding-left:5pt;padding-right:5pt;line-height: 1;background-color:transparent;}.cl-60115cd4{margin:0;text-align:right;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);padding-bottom:5pt;padding-top:5pt;padding-left:5pt;padding-right:5pt;line-height: 1;background-color:transparent;}.cl-60117f70{background-color:rgba(207, 207, 207, 1.00);vertical-align: middle;border-bottom: 1pt solid rgba(102, 102, 102, 1.00);border-top: 1pt solid rgba(102, 102, 102, 1.00);border-left: 1pt solid rgba(102, 102, 102, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-60117f7a{background-color:rgba(207, 207, 207, 1.00);vertical-align: middle;border-bottom: 1pt solid rgba(102, 102, 102, 1.00);border-top: 1pt solid rgba(102, 102, 102, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 1pt solid rgba(102, 102, 102, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-60117f84{background-color:rgba(239, 239, 239, 1.00);vertical-align: middle;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 1pt solid rgba(102, 102, 102, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-60117f8e{background-color:rgba(239, 239, 239, 1.00);vertical-align: middle;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 1pt solid rgba(102, 102, 102, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-60117f98{background-color:transparent;vertical-align: middle;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 1pt solid rgba(102, 102, 102, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-60117f99{background-color:transparent;vertical-align: middle;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 1pt solid rgba(102, 102, 102, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-60117fa2{background-color:rgba(239, 239, 239, 1.00);vertical-align: middle;border-bottom: 1pt solid rgba(102, 102, 102, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 1pt solid rgba(102, 102, 102, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-60117fa3{background-color:rgba(239, 239, 239, 1.00);vertical-align: middle;border-bottom: 1pt solid rgba(102, 102, 102, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 1pt solid rgba(102, 102, 102, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}</style><table data-quarto-disable-processing='true' class='cl-60185912'><caption style="display:table-caption;margin:0pt;text-align:center;border-bottom: 0.00pt solid transparent;border-top: 0.00pt solid transparent;border-left: 0.00pt solid transparent;border-right: 0.00pt solid transparent;padding-top:3pt;padding-bottom:3pt;padding-left:3pt;padding-right:3pt;line-height: 1;background-color:transparent;"><span></span></caption><thead><tr style="overflow-wrap:break-word;"><th class="cl-60117f70"><p class="cl-60115cc0"><span class="cl-600d7376">Term</span></p></th><th class="cl-60117f7a"><p class="cl-60115cd4"><span class="cl-600d7376">CollStrength</span></p></th></tr></thead><tbody><tr style="overflow-wrap:break-word;"><td class="cl-60117f84"><p class="cl-60115cc0"><span class="cl-600d7380">natural</span></p></td><td class="cl-60117f8e"><p class="cl-60115cd4"><span class="cl-600d7380">1,766.44751</span></p></td></tr><tr style="overflow-wrap:break-word;"><td class="cl-60117f98"><p class="cl-60115cc0"><span class="cl-600d7380">theory</span></p></td><td class="cl-60117f99"><p class="cl-60115cd4"><span class="cl-600d7380">127.86330</span></p></td></tr><tr style="overflow-wrap:break-word;"><td class="cl-60117f84"><p class="cl-60115cc0"><span class="cl-600d7380">variations</span></p></td><td class="cl-60117f8e"><p class="cl-60115cd4"><span class="cl-600d7380">124.94947</span></p></td></tr><tr style="overflow-wrap:break-word;"><td class="cl-60117f98"><p class="cl-60115cc0"><span class="cl-600d7380">effects</span></p></td><td class="cl-60117f99"><p class="cl-60115cd4"><span class="cl-600d7380">69.94048</span></p></td></tr><tr style="overflow-wrap:break-word;"><td class="cl-60117f84"><p class="cl-60115cc0"><span class="cl-600d7380">modifications</span></p></td><td class="cl-60117f8e"><p class="cl-60115cd4"><span class="cl-600d7380">63.52192</span></p></td></tr><tr style="overflow-wrap:break-word;"><td class="cl-60117f98"><p class="cl-60115cc0"><span class="cl-600d7380">acts</span></p></td><td class="cl-60117f99"><p class="cl-60115cd4"><span class="cl-600d7380">53.15165</span></p></td></tr><tr style="overflow-wrap:break-word;"><td class="cl-60117f84"><p class="cl-60115cc0"><span class="cl-600d7380">power</span></p></td><td class="cl-60117f8e"><p class="cl-60115cd4"><span class="cl-600d7380">53.14602</span></p></td></tr><tr style="overflow-wrap:break-word;"><td class="cl-60117f98"><p class="cl-60115cc0"><span class="cl-600d7380">slight</span></p></td><td class="cl-60117f99"><p class="cl-60115cd4"><span class="cl-600d7380">48.94158</span></p></td></tr><tr style="overflow-wrap:break-word;"><td class="cl-60117f84"><p class="cl-60115cc0"><span class="cl-600d7380">advantage</span></p></td><td class="cl-60117f8e"><p class="cl-60115cd4"><span class="cl-600d7380">48.21207</span></p></td></tr><tr style="overflow-wrap:break-word;"><td class="cl-60117f98"><p class="cl-60115cc0"><span class="cl-600d7380">disuse</span></p></td><td class="cl-60117f99"><p class="cl-60115cd4"><span class="cl-600d7380">47.84167</span></p></td></tr><tr style="overflow-wrap:break-word;"><td class="cl-60117f84"><p class="cl-60115cc0"><span class="cl-600d7380">accumulated</span></p></td><td class="cl-60117f8e"><p class="cl-60115cd4"><span class="cl-600d7380">46.99429</span></p></td></tr><tr style="overflow-wrap:break-word;"><td class="cl-60117f98"><p class="cl-60115cc0"><span class="cl-600d7380">sexual</span></p></td><td class="cl-60117f99"><p class="cl-60115cd4"><span class="cl-600d7380">44.31103</span></p></td></tr><tr style="overflow-wrap:break-word;"><td class="cl-60117f84"><p class="cl-60115cc0"><span class="cl-600d7380">variation</span></p></td><td class="cl-60117f8e"><p class="cl-60115cd4"><span class="cl-600d7380">43.64372</span></p></td></tr><tr style="overflow-wrap:break-word;"><td class="cl-60117f98"><p class="cl-60115cc0"><span class="cl-600d7380">principle</span></p></td><td class="cl-60117f99"><p class="cl-60115cd4"><span class="cl-600d7380">42.17271</span></p></td></tr><tr style="overflow-wrap:break-word;"><td class="cl-60117fa2"><p class="cl-60115cc0"><span class="cl-600d7380">useful</span></p></td><td class="cl-60117fa3"><p class="cl-60115cd4"><span class="cl-600d7380">39.36931</span></p></td></tr></tbody></table></div>
<p>We can now visualize the association strengths as shown in the code
chunk below.</p>
<pre class="r"><code>ggplot(coocdf, aes(x = reorder(Term, CollStrength, mean), y = CollStrength)) +
  geom_point() +
  coord_flip() +
  theme_bw() +
  labs(y = &quot;&quot;)</code></pre>
<p><img src="coll_new_files/figure-html/assocs03-1.png" width="672" /></p>
<p>The dot chart shows that <em>natural</em> is collocating more
strongly with <em>selection</em> compared to any other term. This
confirms that <em>natural</em> and <em>selection</em> form a collocation
in Darwin’s <em>Origin</em>.</p>
</div>
<div id="dendrograms" class="section level2 unnumbered">
<h2 class="unnumbered">Dendrograms</h2>
<p>Another method for visualizing collocations are dendrograms.
Dendrograms (also called tree-diagrams) show how similar elements are
based on one or many features. As such, dendrograms are used to indicate
groupings as they show elements (words) that are notably similar or
different with respect to their association strength. To use this
method, we first need to generate a distance matrix from our
co-occurrence matrix.</p>
<p>We now reduce the document-feature matrix that we generated above to
contain only the top 20 collocates of organism.</p>
<pre class="r"><code>redux_dfm &lt;- dfm_select(text_dfm, 
                        pattern = c(names(coocs)[1:20], &quot;selection&quot;))</code></pre>
<p>Now, we can transform the document-feature matrix into a
feature-co-occurrence matrix as shown below. A feature-co-occurrence
matrix shows how often each element in that matrix co-occurs with every
other element in that matrix.</p>
<pre class="r"><code>tag_fcm &lt;- fcm(redux_dfm)
# inspect
tag_fcm[1:6, 1:6]</code></pre>
<pre><code>## Feature co-occurrence matrix of: 6 by 6 features.
##            features
## features    natural structure variation effects power selection
##   natural        49        65        31      28    38       515
##   structure       0        12         6       6     6        63
##   variation       0         0         8       8     3        41
##   effects         0         0         0       3     1        39
##   power           0         0         0       0     9        63
##   selection       0         0         0       0     0        79</code></pre>
<pre class="r"><code># create distance matrix
distmtx &lt;- dist(tag_fcm)

clustertexts &lt;- hclust(    # hierarchical cluster object
  distmtx,                 # use distance matrix as data
  method=&quot;ward.D2&quot;)        # ward.D as linkage method

ggdendrogram(clustertexts) +
  ggtitle(&quot;Terms strongly collocating with *selection*&quot;)</code></pre>
<p><img src="coll_new_files/figure-html/coll7-1.png" width="672" /></p>
</div>
<div id="network-graphs" class="section level2 unnumbered">
<h2 class="unnumbered">Network Graphs</h2>
<p>Network graphs are a very useful tool to show relationships (or the
absence of relationships) between elements. Network graphs are highly
useful when it comes to displaying the relationships that words have
among each other and which properties these networks of words have.</p>
<p>Using the feature-co-occurrence matrix we generated above, we can
generate the network graph which shows the terms that collocate with the
target term <em>selection</em> with the edges representing the
co-occurrence frequency. To generate this network graph, we use the
<code>textplot_network</code> function from the
<code>quanteda.textplots</code> package.</p>
<pre class="r"><code># generate network graph
textplot_network(tag_fcm, 
                 min_freq = 5, 
                 edge_alpha = 0.1, 
                 edge_size = 5,
                 edge_color = &quot;purple&quot;,
                 vertex_labelsize = log(colSums(tag_fcm)))</code></pre>
<p><img src="coll_new_files/figure-html/unnamed-chunk-6-1.png" width="672" /></p>
</div>
<div id="biplots" class="section level2 unnumbered">
<h2 class="unnumbered">Biplots</h2>
<p>An alternative way to display co-occurrence patterns are bi-plots
which are used to display the results of Correspondence Analyses. They
are useful, in particular, when one is not interested in one particular
key term and its collocations but in the overall similarity of many
terms. Semantic similarity in this case refers to a shared semantic and
this distributional profile. As such, words can be deemed semantically
similar if they have a similar co-occurrence profile - i.e. they
co-occur with the same elements. Biplots can be used to visualize
collocations because collocates co-occur and thus share semantic
properties which renders then more similar to each other compared with
other terms.</p>
<pre class="r"><code># perform correspondence analysis
res.ca &lt;- CA(as.matrix(tag_fcm), graph = FALSE)
# plot results
fviz_ca_row(res.ca, repel = TRUE, col.row = &quot;gray20&quot;)</code></pre>
<p><img src="coll_new_files/figure-html/coll8-1.png" width="672" /></p>
<p>The bi-plot shows that <em>natural</em> and <em>selection</em>
collocate as they are plotted in close proximity. The advantage of the
biplot becomes apparent when we focus on other terms because the biplot
also shows other collocates such as <em>vary</em> and
<em>independently</em> or <em>might injurious</em>.</p>
</div>
</div>
<div id="citation-session-info" class="section level1 unnumbered">
<h1 class="unnumbered">Citation &amp; Session Info</h1>
<p>Schweinberger, Martin. 2023. <em>Analyzing Co-Occurrences and
Collocations in R</em>. Brisbane: The University of Queensland. url: <a
href="https://ladal.edu.au/coll.html"
class="uri">https://ladal.edu.au/coll.html</a> (Version 2023.05.31).</p>
<pre><code>@manual{schweinberger`2023coll,
  author = {Schweinberger, Martin},
  title = {Analyzing Co-Occurrences and Collocations in R},
  note = {https://ladal.edu.au/coll.html},
  year = {2023},
  organization = {The University of Queensland, Australia. School of Languages and Cultures},
  address = {Brisbane},
  edition = {2023.05.31}
}</code></pre>
<pre class="r"><code>sessionInfo()</code></pre>
<pre><code>## R version 4.3.2 (2023-10-31 ucrt)
## Platform: x86_64-w64-mingw32/x64 (64-bit)
## Running under: Windows 11 x64 (build 22621)
## 
## Matrix products: default
## 
## 
## locale:
## [1] LC_COLLATE=English_Australia.utf8  LC_CTYPE=English_Australia.utf8   
## [3] LC_MONETARY=English_Australia.utf8 LC_NUMERIC=C                      
## [5] LC_TIME=English_Australia.utf8    
## 
## time zone: Australia/Brisbane
## tzcode source: internal
## 
## attached base packages:
## [1] stats     graphics  grDevices utils     datasets  methods   base     
## 
## other attached packages:
##  [1] slam_0.1-50               sna_2.7-2                
##  [3] statnet.common_4.9.0      tm_0.7-11                
##  [5] NLP_0.2-1                 stringr_1.5.1            
##  [7] dplyr_1.1.4               quanteda.textplots_0.94.4
##  [9] quanteda.textstats_0.96.4 quanteda_3.3.1           
## [11] Matrix_1.6-5              network_1.18.2           
## [13] igraph_2.0.2              ggdendro_0.2.0           
## [15] GGally_2.2.1              flextable_0.9.4          
## [17] factoextra_1.0.7          ggplot2_3.5.0            
## [19] FactoMineR_2.10          
## 
## loaded via a namespace (and not attached):
##   [1] sandwich_3.1-0          rlang_1.1.3             magrittr_2.0.3         
##   [4] multcomp_1.4-25         compiler_4.3.2          systemfonts_1.0.5      
##   [7] vctrs_0.6.5             httpcode_0.3.0          pkgconfig_2.0.3        
##  [10] crayon_1.5.2            fastmap_1.1.1           backports_1.4.1        
##  [13] ellipsis_0.3.2          labeling_0.4.3          utf8_1.2.4             
##  [16] promises_1.2.1          rmarkdown_2.25          ragg_1.2.7             
##  [19] purrr_1.0.2             xfun_0.42               cachem_1.0.8           
##  [22] jsonlite_1.8.8          flashClust_1.01-2       SnowballC_0.7.1        
##  [25] highr_0.10              later_1.3.2             uuid_1.2-0             
##  [28] broom_1.0.5             parallel_4.3.2          stopwords_2.3          
##  [31] cluster_2.1.4           R6_2.5.1                stringi_1.8.3          
##  [34] bslib_0.6.1             RColorBrewer_1.1-3      car_3.1-2              
##  [37] jquerylib_0.1.4         estimability_1.5        assertthat_0.2.1       
##  [40] nsyllable_1.0.1         Rcpp_1.0.12             knitr_1.45             
##  [43] klippy_0.0.0.9500       zoo_1.8-12              httpuv_1.6.14          
##  [46] splines_4.3.2           tidyselect_1.2.0        abind_1.4-5            
##  [49] rstudioapi_0.15.0       yaml_2.3.8              codetools_0.2-19       
##  [52] curl_5.2.0              lattice_0.21-9          tibble_3.2.1           
##  [55] plyr_1.8.9              shiny_1.8.0             withr_3.0.0            
##  [58] askpass_1.2.0           coda_0.19-4.1           evaluate_0.23          
##  [61] survival_3.5-7          ggstats_0.5.1           RcppParallel_5.1.7     
##  [64] zip_2.3.1               xml2_1.3.6              ggpubr_0.6.0           
##  [67] pillar_1.9.0            carData_3.0-5           DT_0.32                
##  [70] generics_0.1.3          munsell_0.5.0           scales_1.3.0           
##  [73] xtable_1.8-4            leaps_3.1               glue_1.7.0             
##  [76] gdtools_0.3.6           emmeans_1.10.0          scatterplot3d_0.3-44   
##  [79] tools_4.3.2             gfonts_0.2.0            tokenizers_0.3.0       
##  [82] data.table_1.15.2       ggsignif_0.6.4          mvtnorm_1.2-4          
##  [85] fastmatch_1.1-4         grid_4.3.2              tidyr_1.3.1            
##  [88] colorspace_2.1-0        cli_3.6.2               textshaping_0.3.7      
##  [91] officer_0.6.5           fontBitstreamVera_0.1.1 fansi_1.0.6            
##  [94] gtable_0.3.4            rstatix_0.7.2           sass_0.4.8             
##  [97] digest_0.6.34           fontquiver_0.2.1        ggrepel_0.9.5          
## [100] crul_1.4.0              TH.data_1.1-2           farver_2.1.1           
## [103] htmlwidgets_1.6.4       htmltools_0.5.7         lifecycle_1.0.4        
## [106] multcompView_0.1-9      mime_0.12               fontLiberation_0.1.0   
## [109] openssl_2.1.1           MASS_7.3-60</code></pre>
<hr />
<p><a href="#introduction">Back to top</a></p>
<p><a href="https://ladal.edu.au">Back to LADAL home</a></p>
<hr />
</div>
<div id="references" class="section level1 unnumbered">
<h1 class="unnumbered">References</h1>
<div id="refs" class="references csl-bib-body hanging-indent">
<div id="ref-quanteda" class="csl-entry">
Benoit, Kenneth, Kohei Watanabe, Haiyan Wang, Paul Nulty, Adam Obeng,
Stefan Müller, and Akitaka Matsuo. 2018. <span>“Quanteda: An r Package
for the Quantitative Analysis of Textual Data.”</span> <em>Journal of
Open Source Software</em> 3 (30): 774. <a
href="https://doi.org/10.21105/joss.00774">https://doi.org/10.21105/joss.00774</a>.
</div>
<div id="ref-WN17" class="csl-entry">
Wiedemann, Gregor, and Andreas Niekler. 2017. <span>“Hands-on:
<span>A</span> Five Day Text Mining Course for Humanists and Social
Scientists in <span>R</span>.”</span> In <em>Proceedings of the Workshop
on Teaching <span>NLP</span> for Digital Humanities
(<span>Teach4DH</span>), Berlin, Germany, September 12, 2017.</em>,
57–65. <a
href="http://ceur-ws.org/Vol-1918/wiedemann.pdf">http://ceur-ws.org/Vol-1918/wiedemann.pdf</a>.
</div>
</div>
</div>
<div class="footnotes footnotes-end-of-document">
<hr />
<ol>
<li id="fn1"><p>If you want to render the R Notebook on your machine,
i.e. knitting the document to html or a pdf, you need to make sure that
you have R and RStudio installed and you also need to download the <a
href="https://slcladal.github.io/content/bibliography.bib"><strong>bibliography
file</strong></a> and store it in the same folder where you store the
Rmd file.<a href="#fnref1" class="footnote-back">↩︎</a></p></li>
</ol>
</div>



</div>
</div>

</div>

<script>

// add bootstrap table styles to pandoc tables
function bootstrapStylePandocTables() {
  $('tr.odd').parent('tbody').parent('table').addClass('table table-condensed');
}
$(document).ready(function () {
  bootstrapStylePandocTables();
});


</script>

<!-- tabsets -->

<script>
$(document).ready(function () {
  window.buildTabsets("TOC");
});

$(document).ready(function () {
  $('.tabset-dropdown > .nav-tabs > li').click(function () {
    $(this).parent().toggleClass('nav-tabs-open');
  });
});
</script>

<!-- code folding -->

<script>
$(document).ready(function ()  {

    // temporarily add toc-ignore selector to headers for the consistency with Pandoc
    $('.unlisted.unnumbered').addClass('toc-ignore')

    // move toc-ignore selectors from section div to header
    $('div.section.toc-ignore')
        .removeClass('toc-ignore')
        .children('h1,h2,h3,h4,h5').addClass('toc-ignore');

    // establish options
    var options = {
      selectors: "h1,h2,h3",
      theme: "bootstrap3",
      context: '.toc-content',
      hashGenerator: function (text) {
        return text.replace(/[.\\/?&!#<>]/g, '').replace(/\s/g, '_');
      },
      ignoreSelector: ".toc-ignore",
      scrollTo: 0
    };
    options.showAndHide = true;
    options.smoothScroll = true;

    // tocify
    var toc = $("#TOC").tocify(options).data("toc-tocify");
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
