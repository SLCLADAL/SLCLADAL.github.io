---
title: "Downloading Texts from Project Gutenberg using R"
author: "Martin Schweinberger"
date: "`r format(Sys.time(), '%Y-%m-%d')`"
output:
  bookdown::html_document2: default
bibliography: bibliography.bib
link-citations: yes
---
```{r uq1, echo=F, fig.cap="", message=FALSE, warning=FALSE, out.width='100%'}
knitr::include_graphics("images/uq1.jpg")
```

# Introduction{-}

This tutorial shows how to download and clean works from the Project Gutenberg database using R. The entire R-markdown document for the sections below can be downloaded [here](https://slcladal.github.io/gutenberg.Rmd).

The example that we will be concerned with focuses on the first type of data as it is by far the most common way in which relationships are coded.To show how to create a network, we will have a look at the network that the characters in William Shakespeare's *Romeo and Juliet* form.

## Preparation and session set up{-}

This tutorial is based on R. If you have not installed R or are new to it, you will find an introduction to and more information how to use R [here](https://slcladal.github.io/IntroR_workshop.html). For this tutorials, we need to install certain *packages* from an R *library* so that the scripts shown below are executed without errors. Before turning to the code below, please install the packages by running the code below this paragraph. If you have already installed the packages mentioned below, then you can skip ahead ignore this section. To install the necessary packages, simply run the following code - it may take some time (between 1 and 5 minutes to install all of the libraries so you do not need to worry if it takes some time).

```{r prep1, echo=T, eval = F, message=FALSE, warning=FALSE}
# clean current workspace
rm(list=ls(all=T))
# set options
options(stringsAsFactors = F)         # no automatic data transformation
options("scipen" = 100, "digits" = 4) # supress math annotation
# install libraries
install.packages(c("GGally", "network", "sna", "ggplot2", "dplyr", "knitr", 
                   "kableExtra", "gutenbergr", "stringr", "tm", "Matrix"))
```

Once you have installed R, R-Studio, and have also initiated the session by executing the code shown above, you are good to go.

# Creating a network of characters in *Romeo and Juliet*

In a first step, we load the necessary packages from the library.

```{r net1, echo=T, eval = T, message=FALSE, warning=FALSE}
# activate packages
library(GGally)
library(network)
library(ggplot2)
library(dplyr)
library(sna)
library(knitr)
library(kableExtra)
library(gutenbergr)
library(stringr)
library(tm)
library(Matrix)
```


The issue we want to investigate here relates to networks of personas in Shakespeare's "Romeo and Juliet".

```{r na1, echo=T, eval = T, message=FALSE, warning=FALSE}
# load data
romeo <- gutenberg_works(title == "Romeo and Juliet") %>%
  gutenberg_download(meta_fields = "title")
# inspect data
romeo
```

Now that we have loaded the data, we need to split the data into scenes. Scenes during which personas leave or enter will have to be split too so that we arrive at a table that contains the personas that are present during a sub-scene.

```{r na2, echo=T, eval = T, message=FALSE, warning=FALSE}
# load split
romeoscenes <- romeo %>%
  select(text) %>%
  as.vector() %>%
  str_replace_all(fixed("\""), "") %>%
  str_replace_all(fixed("\n"), "") %>%
  paste(collapse = " ") %>%
  str_replace_all("(Scene )", "qwertz\\1") %>%
  strsplit("qwertz") %>%
  unlist()
# inspect data
str(romeoscenes[2])
```

Now we extract the persons that are present in each scene.

```{r na3, echo=T, eval = T, message=FALSE, warning=FALSE}
# extract persons
romeopersonas <- romeoscenes %>%
  str_match_all(" , [A-Z][a-z]{2,} {0,1}[A-Z]{0,1}[a-z]{0,}\\.")
# inspect data
str(romeopersonas[1:5])
```